"use strict";(self.webpackChunkordspelet=self.webpackChunkordspelet||[]).push([[598],{1598:(sn,Ct,d)=>{d.r(Ct),d.d(Ct,{GameModule:()=>at});var x=d(6895),j=d(5072),bt=d(4463),Mt=d(793),t=d(4650);class Y{constructor(n){this.elemRef=n,this.resized=new t.vpe}onWindowResize(){this.resize()}ngOnInit(){this.resize(),setTimeout(()=>this.resize(),200)}resize(n=!0){const e=this.elemRef.nativeElement.width=this.elemRef.nativeElement.clientWidth,o=this.elemRef.nativeElement.height=this.elemRef.nativeElement.clientHeight;n&&this.resized.emit({width:e,height:o})}static#t=this.\u0275fac=function(e){return new(e||Y)(t.Y36(t.SBq))};static#e=this.\u0275dir=t.lG2({type:Y,selectors:[["canvas","auto-size",""]],hostBindings:function(e,o){1&e&&t.NdJ("resize",function(c){return o.onWindowResize(c)},!1,t.Jf7)},outputs:{resized:"resized"}})}class X{static#t=this.\u0275fac=function(e){return new(e||X)};static#e=this.\u0275mod=t.oAB({type:X});static#n=this.\u0275inj=t.cJS({})}const jt=["c"];class N{set audioData(n){n&&this.render(n)}render(n){const e=this.canvasRef?.nativeElement,o=e?.getContext("2d");if(!e||!o)return;const s=e.width,c=e.height,l=1*s/n.length;o.clearRect(0,0,s,c),o.lineWidth=2,o.strokeStyle="#888",o.beginPath();let v=0;for(var p=0;p<n.length;p++){var O=n[p]/128*c/2;0===p?o.moveTo(v,O):o.lineTo(v,O),v=p*l}o.lineTo(s,n[0]/128*c/2),o.stroke()}static#t=this.\u0275fac=function(e){return new(e||N)};static#e=this.\u0275cmp=t.Xpm({type:N,selectors:[["app-audio-visualizer"]],viewQuery:function(e,o){if(1&e&&t.Gf(jt,5),2&e){let s;t.iGM(s=t.CRH())&&(o.canvasRef=s.first)}},inputs:{audioData:"audioData"},decls:2,vars:0,consts:[["auto-size","",1,"full-fill"],["c",""]],template:function(e,o){1&e&&t._UZ(0,"canvas",0,1)},dependencies:[Y],styles:["[_nghost-%COMP%]{display:inline-block}"]})}class V{static#t=this.\u0275fac=function(e){return new(e||V)};static#e=this.\u0275mod=t.oAB({type:V});static#n=this.\u0275inj=t.cJS({imports:[X]})}var lt={};!function i(n,e,o,s){var c=!!(n.Worker&&n.Blob&&n.Promise&&n.OffscreenCanvas&&n.OffscreenCanvasRenderingContext2D&&n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype.transferControlToOffscreen&&n.URL&&n.URL.createObjectURL);function l(){}function v(a){var r=e.exports.Promise,f=void 0!==r?r:n.Promise;return"function"==typeof f?new f(a):(a(l,l),null)}var r,f,a,u,w,ft,p=(a=Math.floor(16.666666666666668),u={},w=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(r=function(g){var h=Math.random();return u[h]=requestAnimationFrame(function m(b){w===b||w+a-1<b?(w=b,delete u[h],g()):u[h]=requestAnimationFrame(m)}),h},f=function(g){u[g]&&cancelAnimationFrame(u[g])}):(r=function(g){return setTimeout(g,a)},f=function(g){return clearTimeout(g)}),{frame:r,cancel:f}),M=function(){var a,r,f={};return function(){if(a)return a;if(!o&&c){var w=["var CONFETTI, SIZE = {}, module = {};","("+i.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{a=new Worker(URL.createObjectURL(new Blob([w])))}catch(g){return void 0!==typeof console&&"function"==typeof console.warn&&console.warn("\u{1f38a} Could not load worker",g),null}!function u(w){function g(h,m){w.postMessage({options:h||{},callback:m})}w.init=function(m){var b=m.transferControlToOffscreen();w.postMessage({canvas:b},[b])},w.fire=function(m,b,T){if(r)return g(m,null),r;var y=Math.random().toString(36).slice(2);return r=v(function(S){function k(C){C.data.callback===y&&(delete f[y],w.removeEventListener("message",k),r=null,T(),S())}w.addEventListener("message",k),g(m,y),f[y]=k.bind(null,{data:{callback:y}})})},w.reset=function(){for(var m in w.postMessage({reset:!0}),f)f[m](),delete f[m]}}(a)}return a}}(),O={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function _(a,r,f){return function E(a,r){return r?r(a):a}(a&&function U(a){return null!=a}(a[r])?a[r]:O[r],f)}function D(a){return a<0?0:Math.floor(a)}function Be(a,r){return Math.floor(Math.random()*(r-a))+a}function mt(a){return parseInt(a,16)}function ze(a){return a.map(Ne)}function Ne(a){var r=String(a).replace(/[^0-9a-f]/gi,"");return r.length<6&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),{r:mt(r.substring(0,2)),g:mt(r.substring(2,4)),b:mt(r.substring(4,6))}}function Je(a){a.width=document.documentElement.clientWidth,a.height=document.documentElement.clientHeight}function He(a){var r=a.getBoundingClientRect();a.width=r.width,a.height=r.height}function Ye(a){var r=a.angle*(Math.PI/180),f=a.spread*(Math.PI/180);return{x:a.x,y:a.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*a.startVelocity+Math.random()*a.startVelocity,angle2D:-r+(.5*f-Math.random()*f),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:a.color,shape:a.shape,tick:0,totalTicks:a.ticks,decay:a.decay,drift:a.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*a.gravity,ovalScalar:.6,scalar:a.scalar}}function zt(a,r){var y,f=!a,u=!!_(r||{},"resize"),w=_(r,"disableForReducedMotion",Boolean),h=c&&_(r||{},"useWorker")?M():null,m=f?Je:He,b=!(!a||!h||!a.__confetti_initialized),T="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function S(C,gt,vt){for(var z=_(C,"particleCount",D),it=_(C,"angle",Number),ct=_(C,"spread",Number),F=_(C,"startVelocity",Number),Ke=_(C,"decay",Number),qe=_(C,"gravity",Number),tn=_(C,"drift",Number),Rt=_(C,"colors",ze),en=_(C,"ticks",Number),Jt=_(C,"shapes"),nn=_(C,"scalar"),Ht=function Re(a){var r=_(a,"origin",Object);return r.x=_(r,"x",Number),r.y=_(r,"y",Number),r}(C),Qt=z,_t=[],on=a.width*Ht.x,rn=a.height*Ht.y;Qt--;)_t.push(Ye({x:on,y:rn,angle:it,spread:ct,startVelocity:F,color:Rt[Qt%Rt.length],shape:Jt[Be(0,Jt.length)],ticks:en,decay:Ke,gravity:qe,drift:tn,scalar:nn}));return y?y.addFettis(_t):(y=function Ve(a,r,f,u,w){var m,b,g=r.slice(),h=a.getContext("2d"),T=v(function(y){function S(){m=b=null,h.clearRect(0,0,u.width,u.height),w(),y()}m=p.frame(function k(){o&&!(u.width===s.width&&u.height===s.height)&&(u.width=a.width=s.width,u.height=a.height=s.height),!u.width&&!u.height&&(f(a),u.width=a.width,u.height=a.height),h.clearRect(0,0,u.width,u.height),g=g.filter(function(C){return function Xe(a,r){r.x+=Math.cos(r.angle2D)*r.velocity+r.drift,r.y+=Math.sin(r.angle2D)*r.velocity+r.gravity,r.wobble+=r.wobbleSpeed,r.velocity*=r.decay,r.tiltAngle+=.1,r.tiltSin=Math.sin(r.tiltAngle),r.tiltCos=Math.cos(r.tiltAngle),r.random=Math.random()+2,r.wobbleX=r.x+10*r.scalar*Math.cos(r.wobble),r.wobbleY=r.y+10*r.scalar*Math.sin(r.wobble);var f=r.tick++/r.totalTicks,u=r.x+r.random*r.tiltCos,w=r.y+r.random*r.tiltSin,g=r.wobbleX+r.random*r.tiltCos,h=r.wobbleY+r.random*r.tiltSin;if(a.fillStyle="rgba("+r.color.r+", "+r.color.g+", "+r.color.b+", "+(1-f)+")",a.beginPath(),"circle"===r.shape)a.ellipse?a.ellipse(r.x,r.y,Math.abs(g-u)*r.ovalScalar,Math.abs(h-w)*r.ovalScalar,Math.PI/10*r.wobble,0,2*Math.PI):function je(a,r,f,u,w,g,h,m,b){a.save(),a.translate(r,f),a.rotate(g),a.scale(u,w),a.arc(0,0,1,h,m,b),a.restore()}(a,r.x,r.y,Math.abs(g-u)*r.ovalScalar,Math.abs(h-w)*r.ovalScalar,Math.PI/10*r.wobble,0,2*Math.PI);else if("star"===r.shape)for(var m=Math.PI/2*3,b=4*r.scalar,T=8*r.scalar,y=r.x,S=r.y,k=5,C=Math.PI/k;k--;)y=r.x+Math.cos(m)*T,S=r.y+Math.sin(m)*T,a.lineTo(y,S),m+=C,y=r.x+Math.cos(m)*b,S=r.y+Math.sin(m)*b,a.lineTo(y,S),m+=C;else a.moveTo(Math.floor(r.x),Math.floor(r.y)),a.lineTo(Math.floor(r.wobbleX),Math.floor(w)),a.lineTo(Math.floor(g),Math.floor(h)),a.lineTo(Math.floor(u),Math.floor(r.wobbleY));return a.closePath(),a.fill(),r.tick<r.totalTicks}(h,C)}),g.length?m=p.frame(k):S()}),b=S});return{addFettis:function(y){return g=g.concat(y),T},canvas:a,promise:T,reset:function(){m&&p.cancel(m),b&&b()}}}(a,_t,m,gt,vt)).promise}function k(C){var gt=w||_(C,"disableForReducedMotion",Boolean),vt=_(C,"zIndex",Number);if(gt&&T)return v(function(F){F()});f&&y?a=y.canvas:f&&!a&&(a=function Qe(a){var r=document.createElement("canvas");return r.style.position="fixed",r.style.top="0px",r.style.left="0px",r.style.pointerEvents="none",r.style.zIndex=a,r}(vt),document.body.appendChild(a)),u&&!b&&m(a);var z={width:a.width,height:a.height};function it(){if(h){var F={getBoundingClientRect:function(){if(!f)return a.getBoundingClientRect()}};return m(F),void h.postMessage({resize:{width:F.width,height:F.height}})}z.width=z.height=null}function ct(){y=null,u&&n.removeEventListener("resize",it),f&&a&&(document.body.removeChild(a),a=null,b=!1)}return h&&!b&&h.init(a),b=!0,h&&(a.__confetti_initialized=!0),u&&n.addEventListener("resize",it,!1),h?h.fire(C,z,ct):S(C,z,ct)}return k.reset=function(){h&&h.reset(),y&&y.reset()},k}function Nt(){return ft||(ft=zt(null,{useWorker:!0,resize:!0})),ft}e.exports=function(){return Nt().apply(this,arguments)},e.exports.reset=function(){Nt().reset()},e.exports.create=zt}(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),lt,!1);const Yt=lt.exports;class G{constructor(){this.fn=Yt,this.defaultOptions={particleCount:100,spread:70,origin:{y:.7}}}getOptions(n){return Object.assign({},this.defaultOptions,n??{})}run(n){const e=this.getOptions(n);return this.fn(e)}runDelay(n=0,e){return setTimeout(()=>this.run(e),n??0)}getOriginByCoord({x:n=0,y:e=0}){return{x:n/window.innerWidth,y:e/window.innerHeight}}static#t=this.\u0275fac=function(e){return new(e||G)};static#e=this.\u0275prov=t.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}class R{constructor(n){this.confetti=n,this._options={...this.confetti.defaultOptions}}set options(n){this._options=this.confetti.getOptions(n)}get options(){return this._options}ngOnInit(){clearTimeout(this.timer),this.timer=this.confetti.runDelay(this.options.delay,this.options)}ngOnDestroy(){clearTimeout(this.timer)}static#t=this.\u0275fac=function(e){return new(e||R)(t.Y36(G))};static#e=this.\u0275dir=t.lG2({type:R,selectors:[["","confetti",""]],inputs:{options:["confetti","options"]},exportAs:["confetti"]})}class K{static#t=this.\u0275fac=function(e){return new(e||K)};static#e=this.\u0275mod=t.oAB({type:K});static#n=this.\u0275inj=t.cJS({})}var xt=d(7392);class J{constructor(){this.fill=!1,this.fillColor="var(--color-accent)"}static#t=this.\u0275fac=function(e){return new(e||J)};static#e=this.\u0275cmp=t.Xpm({type:J,selectors:[["app-star"]],inputs:{fill:"fill",fillColor:"fillColor"},decls:2,vars:2,template:function(e,o){1&e&&(t.TgZ(0,"mat-icon"),t._uU(1,"star"),t.qZA()),2&e&&t.Udp("color",o.fill?o.fillColor:"var(--color-fg-op-50)")},dependencies:[xt.Hw],styles:["[_nghost-%COMP%]{display:inline-block}"]})}function Xt(i,n){if(1&i&&(t.TgZ(0,"span",1),t._UZ(1,"app-star",2),t.qZA()),2&i){const e=n.$implicit,o=n.index,s=t.oxw();t.Udp("transform",s.warpedStyles[o]),t.xp6(1),t.Q6J("fill",null!=s.ratio&&s.ratio>=e)}}class H{constructor(){this.ratios=[0,.5,.9],this.warpedStyles=[]}ngOnChanges(){this.calcWarpedStyles()}calcWarpedStyles(){if(!this.warped)return;const n=this.warped,e=this.ratios.length/2,o=Math.ceil(e),s=new Array(o).fill(0).map((c,l)=>n*(l/(o-1)-n/2));s.push(s[s.length-1]),this.warpedStyles=this.ratios.map((c,l)=>`translateY(${-(l<=e?s[l]:s[2*e-l-1])}em)`)}static#t=this.\u0275fac=function(e){return new(e||H)};static#e=this.\u0275cmp=t.Xpm({type:H,selectors:[["app-stars"]],inputs:{ratio:"ratio",ratios:"ratios",warped:"warped"},features:[t.TTD],decls:1,vars:1,consts:[["class","star-wrapper",3,"transform",4,"ngFor","ngForOf"],[1,"star-wrapper"],[3,"fill"]],template:function(e,o){1&e&&t.YNc(0,Xt,2,3,"span",0),2&e&&t.Q6J("ngForOf",o.ratios)},dependencies:[x.sg,J],styles:[".star-wrapper[_ngcontent-%COMP%]{display:inline-block}"]})}class q{static#t=this.\u0275fac=function(e){return new(e||q)};static#e=this.\u0275mod=t.oAB({type:q});static#n=this.\u0275inj=t.cJS({imports:[x.ez,Mt.q]})}var kt=d(655),Ot=d(7579),Vt=d(727),te=(d(2076),d(515),d(5577),d(2722));const ee=t.GuJ,oe=Symbol("__destroy"),Dt=Symbol("__decoratorApplied");function Tt(i){return"string"==typeof i?Symbol(`__destroy__${i}`):oe}function Pt(i,n){i[n]||(i[n]=new Ot.x)}function It(i,n){i[n]&&(i[n].next(),i[n].complete(),i[n]=null)}function Lt(i){i instanceof Vt.w0&&i.unsubscribe()}function Gt(i,n){return function(){if(i&&i.call(this),It(this,Tt()),n.arrayName&&function se(i){Array.isArray(i)&&i.forEach(Lt)}(this[n.arrayName]),n.checkProperties)for(const e in this)n.blackList?.includes(e)||Lt(this[e])}}function $t(i={}){return n=>{!function ne(i){return!!i[ee]}(n)?function ae(i,n){i.prototype.ngOnDestroy=Gt(i.prototype.ngOnDestroy,n)}(n,i):function ie(i,n){const e=i.\u0275pipe;e.onDestroy=Gt(e.onDestroy,n)}(n,i),function re(i){i.prototype[Dt]=!0}(n)}}function At(i,n){return e=>{const o=Tt(n);return"string"==typeof n?function de(i,n,e){const o=i[n];Pt(i,e),i[n]=function(){o.apply(this,arguments),It(this,e),i[n]=o}}(i,n,o):Pt(i,o),e.pipe((0,te.R)(i[o]))}}Symbol("CheckerHasBeenSet");var Q=(()=>{return(i=Q||(Q={}))[i.MapLowerToUpper=0]="MapLowerToUpper",i[i.MapUpperToLower=1]="MapUpperToLower",Q;var i})(),P=d(5861),A=d(1135),$=d(4004),dt=d(9841),pe=d(1884),tt=d(9300),ue=d(1881),he=d(2313);const Wt=window.SpeechRecognition||window.webkitSpeechRecognition;class W{constructor(){this.audioContext=new AudioContext,this._status$=new A.X("detecting"),this.status$=this._status$.asObservable(),this._words$=new A.X([]),this.words$=this._words$.asObservable(),this._audioSignal$=new A.X({diff:0,data:Uint8Array.of(0)}),this.audioSignal$=this._audioSignal$.asObservable()}get isSupported(){return!!Wt}get status(){return this._status$.value}get words(){return this._words$.value}get audioSignal(){return this._audioSignal$.value}enableMicrophone(){var n=this;return(0,P.Z)(function*(){try{return n.audioStream=yield navigator.mediaDevices.getUserMedia({audio:!0}),yield new Promise(e=>setTimeout(e,100)),n.trackVoiceSignals(),!0}catch(e){return console.warn(e),n._status$.next("not-allowed"),!1}})()}start(n){var e=this;return(0,P.Z)(function*(){yield e.enableMicrophone(),e.stop(),e._words$.next([]),e.recognition=new Wt;const s=e.recognition;return Object.assign(s,{continuous:!0,lang:"sv-SE",interimResults:!0,maxAlternatives:5},n||{}),s.addEventListener("result",c=>{const l=[];for(const v of c.results)for(const p of v)(p.transcript||"").trim().split(" ").forEach(O=>l.push(O));e._words$.next(l)}),s.addEventListener("error",c=>e._status$.next("not-allowed"===c.error?"not-allowed":"error")),s.addEventListener("start",()=>e._status$.next("started")),s.addEventListener("end",()=>e._status$.next("stopped")),s.start(),{words$:e.words$}})()}stop(){this.recognition&&"function"==typeof this.recognition.stop?(this.recognition.stop(),delete this.audioStream,delete this.recognition):this._status$.next("stopped")}trackVoiceSignals(n=this.audioStream,e=this.audioContext){if(!n||!e)return;const o=e.createMediaStreamSource(n);var s=e.createAnalyser(),c=e.createGain();o.connect(c),c.connect(s),s.fftSize=4096;const l=()=>{requestAnimationFrame(l);const v=s.frequencyBinCount,p=new Uint8Array(v);s.smoothingTimeConstant=.5,c.gain.setValueAtTime(1,e.currentTime),s.getByteFrequencyData(p),s.getByteTimeDomainData(p);let M=1,O=0;for(var E=0;E<v;E++){var U=p[E]/128;M=Math.min(M,U),O=Math.max(M,U)}this._audioSignal$.next({diff:O-M,data:p})};l()}static#t=this.\u0275fac=function(e){return new(e||W)};static#e=this.\u0275prov=t.Yz7({token:W,factory:W.\u0275fac,providedIn:"root"})}class I{constructor(n,e){this.store=n,this.speech=e,this.game$=new A.X(null),this.wordsetId$=this.game$.pipe((0,$.U)(o=>o?.wordsetId)),this.wordset$=(0,dt.a)([this.store.wordSets$,this.wordsetId$]).pipe((0,$.U)(([o,s])=>o.find(c=>c.id===s))),this._subGameIndex$=new A.X(0),this.subGameIndex$=this._subGameIndex$.asObservable(),this.subGame$=(0,dt.a)([this.subGameIndex$,this.game$]).pipe((0,$.U)(([o,s])=>s?.subGames[o])),this.gameInfo$=(0,dt.a)([this.game$,this.wordset$,this.subGameIndex$]).pipe((0,pe.x)(ue.Q),(0,tt.h)(([o,s])=>!(!o||!s)),(0,$.U)(([o,s,c])=>{const l=(o?.subGames||[]).map((p,M)=>({index:M,...p}));return{...o,wordset:s,subGames:l,subGame:{curr:l[c],prev:l[c-1],next:l[c+1]}}}))}init(n,e){const o=Object.values(Q).filter(l=>"number"==typeof l);e||(e=o);const c={wordsetId:n,subGames:e.filter(l=>o.includes(parseInt(l.toString()))).map(l=>({type:l}))};return this.game$.next(c),this._subGameIndex$.next(0),c}setSubGameIndex(n){null==n&&(n=(this.game$.value?.subGames||[]).findIndex(e=>!!e.endedAt)),(n<0||n>=(this.game$.value?.subGames||[]).length)&&(n=0),this._subGameIndex$.next(n)}patchSubGame(n){var e=this;return(0,P.Z)(function*(){const o=e.game$.value;if(!o||!o.subGames)return;const c={...o.subGames[e._subGameIndex$.value],...n},l={...o,subGames:[...o.subGames]};return l.subGames[e._subGameIndex$.value]=c,e.game$.next(l),l})()}static#t=this.\u0275fac=function(e){return new(e||I)(t.LFG(he.d),t.LFG(W))};static#e=this.\u0275prov=t.Yz7({token:I,factory:I.\u0275fac})}var me=d(4859);function fe(i,n){1&i&&(t.TgZ(0,"span",10),t._uU(1,"COMMON.NEXT"),t.qZA())}function ge(i,n){1&i&&(t.TgZ(0,"span",10),t._uU(1,"COMMON.CLOSE"),t.qZA())}const ve=function(){return{delay:2e3}};function _e(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"header",3)(3,"h1",4),t._uU(4,"COMMON.NICEJOB"),t.qZA()(),t.TgZ(5,"div",5)(6,"div",6),t._UZ(7,"app-stars",7),t.qZA()(),t.TgZ(8,"footer",3)(9,"button",8),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.close.emit())}),t.YNc(10,fe,2,0,"span",9),t.YNc(11,ge,2,0,"span",9),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("confetti",t.DdM(5,ve)),t.xp6(6),t.Q6J("ratio",null==e.currSubGame?null:e.currSubGame.scoreRatio)("warped",.3),t.xp6(3),t.Q6J("ngIf",e.nextSubGame),t.xp6(1),t.Q6J("ngIf",!e.nextSubGame)}}class et{constructor(){this.close=new t.vpe}get show(){return!(!this.currSubGame?.endedAt||!this.currSubGame.scoreRatio)}static#t=this.\u0275fac=function(e){return new(e||et)};static#e=this.\u0275cmp=t.Xpm({type:et,selectors:[["app-game-ended"]],inputs:{currSubGame:"currSubGame",nextSubGame:"nextSubGame"},outputs:{close:"close"},decls:1,vars:1,consts:[["class","modal-wrapper fadeIn",4,"ngIf"],[1,"modal-wrapper","fadeIn"],[1,"modal-box","scaleUp",3,"confetti"],[1,"p-1","text-center"],["translate","",1,"m-0","scaleUp"],[1,"px-1","flex-center"],[1,"ts-300p","lh-80"],[1,"d-block",3,"ratio","warped"],["mat-raised-button","","color","primary",3,"click"],["translate","",4,"ngIf"],["translate",""]],template:function(e,o){1&e&&t.YNc(0,_e,12,6,"div",0),2&e&&t.Q6J("ngIf",o.show)},dependencies:[x.O5,bt.Pi,me.lW,H,R],styles:[".fadeIn[_ngcontent-%COMP%]{opacity:0;animation:.5s _ngcontent-%COMP%_fadeIn forwards}.scaleUp[_ngcontent-%COMP%]{transform:scale(0);animation:.5s _ngcontent-%COMP%_scaleUp cubic-bezier(.5,0,.5,2.2) forwards}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleUp{0%{transform:scale(0)}to{transform:scale(1)}}.modal-box[_ngcontent-%COMP%]{min-width:16em}.modal-box.scaleUp[_ngcontent-%COMP%]{animation-delay:.3s}.modal-box[_ngcontent-%COMP%]   h1.scaleUp[_ngcontent-%COMP%]{animation-delay:.8s}@keyframes _ngcontent-%COMP%_scaleUpSpin{0%{transform:scale(0) rotate(-180deg)}to{transform:scale(1) rotate(0)}}[_nghost-%COMP%]     app-stars .star-wrapper app-star{transform:scale(0) rotate(-180deg);animation:.7s _ngcontent-%COMP%_scaleUpSpin cubic-bezier(.5,0,.5,2.2) forwards}[_nghost-%COMP%]     app-stars .star-wrapper:nth-of-type(1) app-star{animation-delay:1s}[_nghost-%COMP%]     app-stars .star-wrapper:nth-of-type(2) app-star{animation-delay:1.2s}[_nghost-%COMP%]     app-stars .star-wrapper:nth-of-type(3) app-star{animation-delay:1.4s}"]})}const we=["*"];var L=(()=>{return(i=L||(L={})).Idle="idle",i.Hover="hover",i.Wrong="wrong",i.Correct="correct",L;var i})();class nt{constructor(){this.state=L.Idle}static#t=this.\u0275fac=function(e){return new(e||nt)};static#e=this.\u0275cmp=t.Xpm({type:nt,selectors:[["app-word"]],inputs:{state:"state",bgcolor:"bgcolor",innerStyle:"innerStyle",innerClass:"innerClass"},ngContentSelectors:we,decls:2,vars:7,consts:[[3,"ngClass","ngStyle"]],template:function(e,o){1&e&&(t.F$t(),t.TgZ(0,"span",0),t.Hsn(1),t.qZA()),2&e&&(t.Gre("state-",o.state,""),t.Udp("background-color",o.bgcolor),t.Q6J("ngClass",o.innerClass)("ngStyle",o.innerStyle))},dependencies:[x.mk,x.PC],styles:["[_nghost-%COMP%] > span[_ngcontent-%COMP%]{display:block;position:relative;padding:.5em;color:var(--color-fg);background:var(--color-bg);background:white;border-radius:.5em;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);transition:.2s;transition-property:transform,box-shadow,background}[_nghost-%COMP%] > span.state-idle[_ngcontent-%COMP%], [_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{background:lightyellow}[_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{transform:scale(1.15)}[_nghost-%COMP%] > span.state-wrong[_ngcontent-%COMP%]{background:salmon!important;animation:.5s .2s _ngcontent-%COMP%_wrong ease-in-out 1}[_nghost-%COMP%] > span.state-correct[_ngcontent-%COMP%]{background:palegreen!important;animation:1.5s .1s _ngcontent-%COMP%_correct ease-in-out 1 forwards}@keyframes _ngcontent-%COMP%_wrong{0%,to{transform:translate(0)}15%,45%,75%{transform:translate(-.5em)}30%,60%,90%{transform:translate(.5em)}}@keyframes _ngcontent-%COMP%_correct{0%,10%,30%,50%{transform:scale(1)}20%,40%{transform:scale(1.15)}0%,80%{opacity:1}to{opacity:.5}}"]})}class ot{constructor(){this.patch=new t.vpe}static#t=this.\u0275fac=function(e){return new(e||ot)};static#e=this.\u0275cmp=t.Xpm({type:ot,selectors:[["ng-component"]],inputs:{gameInfo:"gameInfo"},outputs:{patch:"patch"},decls:0,vars:0,template:function(e,o){},encapsulation:2})}var pt=d(1206),ye=d(4986),Zt=d(4482),ut=d(5403),Ce=d(8421);const Bt={leading:!0,trailing:!1};var Me=d(5963);var Oe=d(590);const Se=["iconRef"];function De(i,n){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",2)(2,"span",3,4),t.NdJ("click",function(){t.CHM(e);const s=t.oxw(2);return t.KtG(s.iconClick.emit())}),t.TgZ(4,"mat-icon"),t._uU(5),t.qZA()(),t._UZ(6,"app-audio-visualizer",5),t.ALo(7,"async"),t.qZA(),t.BQk()}if(2&i){const e=n.ngIf,o=t.oxw(2);t.xp6(1),t.Udp("--shake-x",e.x)("--shake-y",e.y),t.xp6(4),t.Oqu(o.locked?"lock":"mood"),t.xp6(1),t.Q6J("audioData",t.lcZ(7,6,o.audioData$))}}function Te(i,n){if(1&i&&(t.ynx(0),t.YNc(1,De,8,8,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,e.shakePos$))}}const Pe=["*"];let ht=class wt{constructor(n,e){this.speech=n,this.confetti=e,this.disabled=!1,this.lockedChanged=new t.vpe,this.iconClick=new t.vpe,this._locked$=new A.X(!0),this.locked$=this._locked$.asObservable(),this.shakePos$=this.speech.audioSignal$.pipe(function xe(i,n=ye.z,e=Bt){const o=(0,Me.H)(i,n);return function be(i,n=Bt){return(0,Zt.e)((e,o)=>{const{leading:s,trailing:c}=n;let l=!1,v=null,p=null,M=!1;const O=()=>{p?.unsubscribe(),p=null,c&&(_(),M&&o.complete())},E=()=>{p=null,M&&o.complete()},U=D=>p=(0,Ce.Xf)(i(D)).subscribe((0,ut.x)(o,O,E)),_=()=>{if(l){l=!1;const D=v;v=null,o.next(D),!M&&U(D)}};e.subscribe((0,ut.x)(o,D=>{l=!0,v=D,(!p||p.closed)&&(s?_():U(D))},()=>{M=!0,(!(c&&l&&p)||p.closed)&&o.complete()}))})}(()=>o,e)}(50),function ke(){return(0,Zt.e)((i,n)=>{let e,o=!1;i.subscribe((0,ut.x)(n,s=>{const c=e;e=s,o&&n.next([c,s]),o=!0}))})}(),(0,$.U)(([o,s])=>{const c=p=>(Math.round(Math.random())?-1:1)*p;return{x:c(o.diff),y:c(s.diff)}})),this.audioData$=this.speech.audioSignal$.pipe((0,tt.h)(o=>!!o),(0,$.U)(o=>o.data)),this._initted=!1}get locked(){return this._locked$.value}get isListening(){return"started"===this.speech.status}ngOnChanges(n){n.disabled&&(this.disabled&&"started"===this.speech.status&&this.stop(),!this.disabled&&"started"!==this.speech.status&&this._initted&&this.start())}ngOnInit(){this.locked$.pipe(At(this)).subscribe(n=>this.lockedChanged.emit(n&&!this.disabled)),this.disabled||this.start(),this._initted=!0}ngOnDestroy(){this.stop()}start(){var n=this;return(0,P.Z)(function*(){if(!n.speech.isSupported)return void n._locked$.next(!1);n._locked$.next(!0);const{words$:e}=yield n.speech.start();e.pipe(At(n),(0,tt.h)(s=>!(!n.word||!s?.length)),(0,$.U)(s=>s.find(c=>c.toLocaleLowerCase().trim()===n.word.toLocaleLowerCase().trim())),(0,tt.h)(s=>!!s),(0,Oe.P)()).subscribe(()=>n.breakLock())})()}stop(){this.speech.stop(),this._locked$.next(!1)}breakLock(){this._locked$.next(!1),this.speech.stop();const n=this.iconRef?.nativeElement.getBoundingClientRect();if(n){const s=this.confetti.getOriginByCoord({x:n.x+n.width/2,y:n.y+n.height/2});this.confetti.run({origin:s,particleCount:12,spread:70,startVelocity:15})}}static#t=this.\u0275fac=function(e){return new(e||wt)(t.Y36(W),t.Y36(G))};static#e=this.\u0275cmp=t.Xpm({type:wt,selectors:[["app-speech-lock"]],viewQuery:function(e,o){if(1&e&&t.Gf(Se,5),2&e){let s;t.iGM(s=t.CRH())&&(o.iconRef=s.first)}},hostVars:4,hostBindings:function(e,o){2&e&&t.ekj("locked",o.locked)("listening",o.isListening)},inputs:{word:"word",disabled:"disabled"},outputs:{lockedChanged:"lockedChanged",iconClick:"iconClick"},exportAs:["speechLock"],features:[t.TTD],ngContentSelectors:Pe,decls:3,vars:1,consts:[[1,"content"],[4,"ngIf"],[1,"box"],[1,"icon",3,"click"],["iconRef",""],[3,"audioData"]],template:function(e,o){1&e&&(t.F$t(),t.TgZ(0,"div",0),t.Hsn(1),t.qZA(),t.YNc(2,Te,3,3,"ng-container",1)),2&e&&(t.xp6(2),t.Q6J("ngIf",!o.disabled))},dependencies:[x.O5,xt.Hw,N,x.Ov],styles:["[_nghost-%COMP%]{display:inline-block;position:relative;padding:1em 1em 1.5em}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{position:relative;z-index:2}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;z-index:1;background:white;border-radius:.5em;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);animation:.3s _ngcontent-%COMP%_pop ease-in forwards}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:white;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);width:2em;height:2em;position:absolute;z-index:4;left:50%;bottom:0;transform:translate(-50%,50%);background:var(--color-bg);border-radius:50%}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:125%}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   app-audio-visualizer[_ngcontent-%COMP%]{display:none;width:calc(100% - 1em);height:2em;position:absolute;bottom:-2px;left:50%;transform:translate(-50%,50%);z-index:3}.locked[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{animation:none}.listening[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{animation:1s _ngcontent-%COMP%_listening ease-in-out infinite;transition:.1s;transform:translate(calc(-50% + var(--shake-x) * .2em),calc(50% + var(--shake-y) * .2em))}.listening[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   app-audio-visualizer[_ngcontent-%COMP%]{display:inline-block}@keyframes _ngcontent-%COMP%_pop{0%{transform:scale(1);opacity:1}to{transform:scale(1.5);opacity:0}}@keyframes _ngcontent-%COMP%_listening{0%,to{border-color:var(--color-fg)}50%{border-color:var(--color-warn)}}"]})};function Ie(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"app-speech-lock",5,6),t.NdJ("lockedChanged",function(s){t.CHM(e);const c=t.oxw();return t.KtG(c.isCurrWordLocked=s)})("iconClick",function(){t.CHM(e);const s=t.MAs(2);return t.KtG(s.breakLock())}),t.TgZ(3,"app-word",7),t.NdJ("cdkDragDropped",function(s){t.CHM(e);const c=t.oxw();return t.KtG(c.onDragDrop(s))}),t._uU(4),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(1),t.Q6J("word",e.currWord)("disabled",!e.useSpeechLock),t.xp6(2),t.Q6J("cdkDragData",e.currWord)("cdkDragBoundary",e.isCurrWordLocked?"app-speech-lock":""),t.xp6(1),t.hij(" ",e.formatWord(e.currWord,!0)," ")}}function Le(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"div",8),t.NdJ("cdkDropListEntered",function(s){t.CHM(e);const c=t.oxw();return t.KtG(c.onDragEnter(s))})("cdkDropListExited",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.resetUI())}),t.TgZ(1,"app-word",9),t.NdJ("click",function(s){const l=t.CHM(e).$implicit,v=t.oxw();return t.KtG(v.onWordChosen(l,s))}),t._uU(2),t.qZA()()}if(2&i){const e=n.$implicit,o=t.oxw();t.Q6J("cdkDropListDisabled",o.wordsDone.includes(e))("cdkDropListData",e),t.xp6(1),t.Q6J("state",o.wordState(e)),t.xp6(1),t.hij(" ",o.formatWord(e,!1)," ")}}ht=(0,kt.gn)([$t()],ht);const Ge=function(){return[]};class rt extends ot{constructor(n){super(),this.confetti=n,this.useSpeechLock=!0,this.wordsDone=[],this.isCurrWordLocked=!0,this.wrongMoves=[]}ngOnInit(){const n=Date.now();this.patch.emit({startedAt:n}),this.randomWord()}getStats(){const n=this.gameInfo?.wordset.words||[],e=this.wordsDone,o=n.filter(M=>!this.wordsDone.includes(M)),s=this.wordsDone.length,l=this.wrongMoves.length,v=s+l;return{allWords:n,wordsLeft:o,wordsDone:e,done:s,left:o.length,wrong:l,total:v,scoreRatio:v>0?s/v:0}}sendStats(){const{scoreRatio:n,left:e}=this.getStats(),o=e<=0?Date.now():void 0;this.patch.emit({scoreRatio:n,endedAt:o})}randomWord(){var n=this;return(0,P.Z)(function*(){n.currWord=void 0,yield new Promise(s=>setTimeout(s,100));const{wordsLeft:e}=n.getStats(),o=Math.floor(Math.random()*e.length);n.currWord=e[o]})()}trackByValue(n,e){return e}formatWord(n,e){return n[e&&!this.inversed||this.inversed&&!e?"toLocaleUpperCase":"toLocaleLowerCase"]()}resetUI(){this.hoverWord=void 0,this.wrongWord=void 0}onWordChosen(n,e){const o=this.currWord,s=n;if(!o||this.isCurrWordLocked)return;const{wordsLeft:c}=this.getStats();o===s?(this.wordsDone.push(o),this.randomWord(),this.confettiByEvent(e)):(this.resetUI(),s&&c.includes(s)&&(this.wrongMoves.push({from:o,to:s}),this.wrongWord=s,clearTimeout(this._aniTimer),this._aniTimer=setTimeout(()=>this.resetUI(),1200))),this.sendStats()}onDragDrop(n){var e=this;return(0,P.Z)(function*(){e.onWordChosen(n.container.data,n.event)})()}onDragEnter(n){this.resetUI(),this.hoverWord=n.container.data}wordState(n){return this.wordsDone.includes(n)?L.Correct:this.hoverWord===n?L.Hover:this.wrongWord===n?L.Wrong:L.Idle}confettiByEvent(n){if(!n)return;const{clientX:e,clientY:o}=n.changedTouches?.[0]||n,s=this.confetti.getOriginByCoord({x:e,y:o});this.confetti.run({origin:s,particleCount:12,spread:70,startVelocity:15})}static#t=this.\u0275fac=function(e){return new(e||rt)(t.Y36(G))};static#e=this.\u0275cmp=t.Xpm({type:rt,selectors:[["app-map-lower-upper-words"]],inputs:{inversed:"inversed"},features:[t.qOj],decls:5,vars:6,consts:[["cdkDropListGroup","",1,"wrapper","full-fill","bg-op-5"],["cdkDropList","",1,"flex-center",3,"dblclick"],["class","p-1",4,"ngIf"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-1"],[3,"word","disabled","lockedChanged","iconClick"],["lockBox",""],["bgcolor","var(--color-primary-light-2)","innerClass","px-1 ts-120p","cdkDrag","",3,"cdkDragData","cdkDragBoundary","cdkDragDropped"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited"],[3,"state","click"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"main",1),t.NdJ("dblclick",function(){return o.useSpeechLock=!o.useSpeechLock}),t.YNc(2,Ie,5,5,"div",2),t.qZA(),t.TgZ(3,"aside"),t.YNc(4,Le,3,4,"div",3),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",o.currWord),t.xp6(1),t.ekj("opacity-70",o.isCurrWordLocked),t.xp6(1),t.Q6J("ngForOf",(null==o.gameInfo||null==o.gameInfo.wordset?null:o.gameInfo.wordset.words)||t.DdM(5,Ge))("ngForTrackBy",o.trackByValue))},dependencies:[x.sg,x.O5,pt.Wj,pt.Fd,pt.Zt,nt,ht],styles:[".wrapper[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto minmax(10em,30%)}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]{grid-template:8em auto/auto}}.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto;align-items:center;overflow:auto;gap:.5em;padding:1em}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{grid-template:auto/repeat(2,calc(50% - .25em))}}.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}"]})}function $e(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"app-map-lower-upper-words",5),t.NdJ("patch",function(s){t.CHM(e);const c=t.oxw(2);return t.KtG(c.game.patchSubGame(s))}),t.qZA()}if(2&i){const e=t.oxw().ngIf;t.Q6J("gameInfo",e)}}function Ee(i,n){if(1&i){const e=t.EpF();t.TgZ(0,"app-map-lower-upper-words",6),t.NdJ("patch",function(s){t.CHM(e);const c=t.oxw(2);return t.KtG(c.game.patchSubGame(s))}),t.qZA()}if(2&i){const e=t.oxw().ngIf;t.Q6J("gameInfo",e)("inversed",!0)}}function Ue(i,n){if(1&i){const e=t.EpF();t.ynx(0)(1,1),t.YNc(2,$e,1,1,"app-map-lower-upper-words",2),t.YNc(3,Ee,1,2,"app-map-lower-upper-words",3),t.BQk(),t.TgZ(4,"app-game-ended",4),t.NdJ("close",function(){const c=t.CHM(e).ngIf,l=t.oxw();return t.KtG(l.setNextOrExit(c.subGame.next))}),t.qZA(),t.BQk()}if(2&i){const e=n.ngIf,o=t.oxw();t.xp6(1),t.Q6J("ngSwitch",e.subGame.curr.type),t.xp6(1),t.Q6J("ngSwitchCase",o.SubGameType.MapLowerToUpper),t.xp6(1),t.Q6J("ngSwitchCase",o.SubGameType.MapUpperToLower),t.xp6(1),t.Q6J("currSubGame",e.subGame.curr)("nextSubGame",e.subGame.next)}}let st=class yt{constructor(n,e){this.game=n,this.router=e,this.SubGameType=Q}setNextOrExit(n){n?this.game.setSubGameIndex(n.index):this.router.navigate(["/home"])}static#t=this.\u0275fac=function(e){return new(e||yt)(t.Y36(I),t.Y36(j.F0))};static#e=this.\u0275cmp=t.Xpm({type:yt,selectors:[["app-game"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngSwitch"],[3,"gameInfo","patch",4,"ngSwitchCase"],[3,"gameInfo","inversed","patch",4,"ngSwitchCase"],[3,"currSubGame","nextSubGame","close"],[3,"gameInfo","patch"],[3,"gameInfo","inversed","patch"]],template:function(e,o){1&e&&(t.YNc(0,Ue,5,5,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,o.game.gameInfo$))},dependencies:[x.O5,x.RF,x.n9,et,rt,x.Ov],encapsulation:2})};st=(0,kt.gn)([$t()],st);var Fe=d(6805),Ae=d(930);class Z{constructor(n,e){this.game=n,this.router=e}canActivate(n){var e=this;return(0,P.Z)(function*(){const o=n.params.wordsetId,s=n.queryParams.subGames?.split(","),c=e.game.init(o,s);return e.router.createUrlTree(["/game",c.wordsetId])})()}static#t=this.\u0275fac=function(e){return new(e||Z)(t.LFG(I),t.LFG(j.F0))};static#e=this.\u0275prov=t.Yz7({token:Z,factory:Z.\u0275fac})}class B{constructor(n,e){this.game=n,this.router=e}canActivate(n){var e=this;return(0,P.Z)(function*(){const o=n.params.wordsetId,s=yield function We(i,n){const e="object"==typeof n;return new Promise((o,s)=>{const c=new Ae.Hp({next:l=>{o(l),c.unsubscribe()},error:s,complete:()=>{e?o(n.defaultValue):s(new Fe.K)}});i.subscribe(c)})}(e.game.game$),c=e.router.createUrlTree(["/game",o,"new"]);return!!s||c})()}static#t=this.\u0275fac=function(e){return new(e||B)(t.LFG(I),t.LFG(j.F0))};static#e=this.\u0275prov=t.Yz7({token:B,factory:B.\u0275fac})}const Ze=[{path:":wordsetId",component:st,canActivate:[B]},{path:":wordsetId/new",component:st,canActivate:[Z]}];class at{static#t=this.\u0275fac=function(e){return new(e||at)};static#e=this.\u0275mod=t.oAB({type:at});static#n=this.\u0275inj=t.cJS({providers:[I,Z,B],imports:[x.ez,j.Bz.forChild(Ze),bt.aw.forChild(),Mt.q,q,K,V]})}}}]);