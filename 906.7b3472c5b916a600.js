"use strict";(self.webpackChunkordspelet=self.webpackChunkordspelet||[]).push([[906],{9906:(It,k,i)=>{i.r(k),i.d(k,{GameModule:()=>T});var d=i(6895),x=i(6319),P=i(793),e=i(4650),K=i(3336);class w{constructor(){this.fill=!1,this.fillColor="var(--color-accent)"}static#t=this.\u0275fac=function(t){return new(t||w)};static#e=this.\u0275cmp=e.Xpm({type:w,selectors:[["app-star"]],inputs:{fill:"fill",fillColor:"fillColor"},decls:2,vars:2,template:function(t,r){1&t&&(e.TgZ(0,"mat-icon"),e._uU(1,"star"),e.qZA()),2&t&&e.Udp("color",r.fill?r.fillColor:"var(--color-fg-op-50)")},dependencies:[K.Hw],styles:["[_nghost-%COMP%]{display:inline-block}"]})}function V(n,o){if(1&n&&e._UZ(0,"app-star",1),2&n){const t=o.$implicit,r=o.index,s=e.oxw();e.Udp("transform",s.warpedStyles[r]),e.Q6J("fill",null!=s.ratio&&s.ratio>=t)}}class b{constructor(){this.ratios=[0,.5,.9],this.warpedStyles=[]}ngOnChanges(){this.calcWarpedStyles()}calcWarpedStyles(){if(!this.warped)return;const o=this.warped,t=this.ratios.length/2,r=Math.ceil(t),s=new Array(r).fill(0).map((a,c)=>o*(c/(r-1)-o/2));s.push(s[s.length-1]),this.warpedStyles=this.ratios.map((a,c)=>`translateY(${-(c<=t?s[c]:s[2*t-c-1])}em)`)}static#t=this.\u0275fac=function(t){return new(t||b)};static#e=this.\u0275cmp=e.Xpm({type:b,selectors:[["app-stars"]],inputs:{ratio:"ratio",ratios:"ratios",warped:"warped"},features:[e.TTD],decls:1,vars:1,consts:[[3,"fill","transform",4,"ngFor","ngForOf"],[3,"fill"]],template:function(t,r){1&t&&e.YNc(0,V,1,3,"app-star",0),2&t&&e.Q6J("ngForOf",r.ratios)},dependencies:[d.sg,w],encapsulation:2})}class _{static#t=this.\u0275fac=function(t){return new(t||_)};static#e=this.\u0275mod=e.oAB({type:_});static#o=this.\u0275inj=e.cJS({imports:[d.ez,P.q]})}var Z=i(655),A=i(7579),q=i(727),ot=(i(2076),i(515),i(5577),i(2722));const nt=e.GuJ,st=Symbol("__destroy"),E=Symbol("__decoratorApplied");function F(n){return"string"==typeof n?Symbol(`__destroy__${n}`):st}function B(n,o){n[o]||(n[o]=new A.x)}function J(n,o){n[o]&&(n[o].next(),n[o].complete(),n[o]=null)}function Q(n){n instanceof q.w0&&n.unsubscribe()}function j(n,o){return function(){if(n&&n.call(this),J(this,F()),o.arrayName&&function it(n){Array.isArray(n)&&n.forEach(Q)}(this[o.arrayName]),o.checkProperties)for(const t in this)o.blackList?.includes(t)||Q(this[t])}}function N(n={}){return o=>{!function rt(n){return!!n[nt]}(o)?function ct(n,o){n.prototype.ngOnDestroy=j(n.prototype.ngOnDestroy,o)}(o,n):function pt(n,o){const t=n.\u0275pipe;t.onDestroy=j(t.onDestroy,o)}(o,n),function at(n){n.prototype[E]=!0}(o)}}Symbol("CheckerHasBeenSet");var y=(()=>{return(n=y||(y={}))[n.MapLowerToUpper=0]="MapLowerToUpper",n[n.MapUpperToLower=1]="MapUpperToLower",y;var n})(),$=i(5861),f=i(1135),l=i(4004),g=i(9841),R=i(1884),ft=i(9300),z=i(1881),gt=i(2313);class u{constructor(o){this.store=o,this.game$=new f.X(null),this.wordsetId$=this.game$.pipe((0,l.U)(t=>t?.wordsetId)),this.wordset$=(0,g.a)([this.store.wordSets$,this.wordsetId$]).pipe((0,l.U)(([t,r])=>t.find(s=>s.id===r))),this._subGameIndex$=new f.X(0),this.subGameIndex$=this._subGameIndex$.asObservable(),this.subGame$=(0,g.a)([this.subGameIndex$,this.game$]).pipe((0,l.U)(([t,r])=>r?.subGames[t])),this.gameInfo$=(0,g.a)([this.game$,this.wordset$,this.subGameIndex$]).pipe((0,R.x)(z.Q),(0,ft.h)(([t,r])=>!(!t||!r)),(0,l.U)(([t,r,s])=>{const a=(t?.subGames||[]).map((C,D)=>({index:D,...C}));return{...t,wordset:r,subGames:a,subGame:{curr:a[s],prev:a[s-1],next:a[s+1]}}}))}init(o,t){const r=Object.values(y).filter(c=>"number"==typeof c);t||(t=r);const a={wordsetId:o,subGames:t.filter(c=>r.includes(parseInt(c.toString()))).map(c=>({type:c}))};return this.game$.next(a),this._subGameIndex$.next(0),a}setSubGameIndex(o){null==o&&(o=(this.game$.value?.subGames||[]).findIndex(t=>!!t.endedAt)),(o<0||o>=(this.game$.value?.subGames||[]).length)&&(o=0),this._subGameIndex$.next(o)}patchSubGame(o){var t=this;return(0,$.Z)(function*(){const r=t.game$.value;if(!r||!r.subGames)return;const a={...r.subGames[t._subGameIndex$.value],...o},c={...r,subGames:[...r.subGames]};return c.subGames[t._subGameIndex$.value]=a,t.game$.next(c),c})()}static#t=this.\u0275fac=function(t){return new(t||u)(e.LFG(gt.d))};static#e=this.\u0275prov=e.Yz7({token:u,factory:u.\u0275fac})}var p=i(7340),ht=i(4859);function vt(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Next"),e.qZA())}function wt(n,o){1&n&&(e.TgZ(0,"span"),e._uU(1,"Close"),e.qZA())}function bt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"header",3)(3,"h1",4),e._uU(4,"Nice job!"),e.qZA()(),e.TgZ(5,"div",5)(6,"div",6),e._UZ(7,"app-stars",7),e.qZA()(),e.TgZ(8,"footer",3)(9,"button",8),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.close.emit())}),e.YNc(10,vt,2,0,"span",9),e.YNc(11,wt,2,0,"span",9),e.qZA()()()()}if(2&n){const t=e.oxw();e.Q6J("@showModalAnimation",void 0),e.xp6(7),e.Q6J("ratio",null==t.currSubGame?null:t.currSubGame.scoreRatio)("warped",.3),e.xp6(3),e.Q6J("ngIf",!t.nextSubGame),e.xp6(1),e.Q6J("ngIf",t.nextSubGame)}}class G{constructor(){this.close=new e.vpe}get show(){return!(!this.currSubGame?.endedAt||!this.currSubGame.scoreRatio)}static#t=this.\u0275fac=function(t){return new(t||G)};static#e=this.\u0275cmp=e.Xpm({type:G,selectors:[["app-game-ended"]],inputs:{currSubGame:"currSubGame",nextSubGame:"nextSubGame"},outputs:{close:"close"},decls:1,vars:1,consts:[["class","modal-wrapper",4,"ngIf"],[1,"modal-wrapper"],[1,"modal-box"],[1,"p-1","text-center"],[1,"m-0"],[1,"px-1","flex-center"],[1,"ts-300p","lh-80"],[1,"d-block",3,"ratio","warped"],["mat-raised-button","","color","primary",3,"click"],[4,"ngIf"]],template:function(t,r){1&t&&e.YNc(0,bt,12,5,"div",0),2&t&&e.Q6J("ngIf",r.show)},dependencies:[d.O5,ht.lW,b],styles:[".modal-box[_ngcontent-%COMP%]{min-width:16em}"],data:{animation:[(0,p.X$)("showModalAnimation",[(0,p.eR)(":enter",[(0,p.ru)([(0,p.IO)(".modal-box",(0,p.oB)({transform:"scale(0)"})),(0,p.IO)(":self",[(0,p.oB)({opacity:0}),(0,p.jt)("0.2s",(0,p.oB)({opacity:1}))]),(0,p.IO)(".modal-box",(0,p.jt)("0.2s",(0,p.oB)({transform:"scale(1)"})))])]),(0,p.eR)(":leave",[(0,p.ru)([(0,p.IO)(".modal-box",(0,p.jt)("0.2s",(0,p.oB)({transform:"scale(0)"}))),(0,p.IO)(":self",[(0,p.oB)({opacity:1}),(0,p.jt)("0.2s",(0,p.oB)({opacity:0}))])])])])]}})}const yt=["*"];var m=(()=>{return(n=m||(m={})).Idle="idle",n.Hover="hover",n.Wrong="wrong",n.Correct="correct",m;var n})();class O{constructor(){this.state=m.Idle}static#t=this.\u0275fac=function(t){return new(t||O)};static#e=this.\u0275cmp=e.Xpm({type:O,selectors:[["app-word"]],inputs:{state:"state",bgcolor:"bgcolor",innerStyle:"innerStyle",innerClass:"innerClass"},ngContentSelectors:yt,decls:2,vars:7,consts:[[3,"ngClass","ngStyle"]],template:function(t,r){1&t&&(e.F$t(),e.TgZ(0,"span",0),e.Hsn(1),e.qZA()),2&t&&(e.Gre("state-",r.state,""),e.Udp("background-color",r.bgcolor),e.Q6J("ngClass",r.innerClass)("ngStyle",r.innerStyle))},dependencies:[d.mk,d.PC],styles:["[_nghost-%COMP%] > span[_ngcontent-%COMP%]{display:block;position:relative;padding:.5em;color:var(--color-fg);background:var(--color-bg);background:white;border-radius:.5em;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);transition:.2s;transition-property:transform,box-shadow,background}[_nghost-%COMP%] > span.state-idle[_ngcontent-%COMP%], [_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{background:lightyellow}[_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{transform:scale(1.15)}[_nghost-%COMP%] > span.state-wrong[_ngcontent-%COMP%]{background:salmon!important;animation:.5s .2s _ngcontent-%COMP%_wrong ease-in-out 1}[_nghost-%COMP%] > span.state-correct[_ngcontent-%COMP%]{background:palegreen!important;animation:1.5s .1s _ngcontent-%COMP%_correct ease-in-out 1 forwards}@keyframes _ngcontent-%COMP%_wrong{0%,to{transform:translate(0)}15%,45%,75%{transform:translate(-.5em)}30%,60%,90%{transform:translate(.5em)}}@keyframes _ngcontent-%COMP%_correct{0%,10%,30%,50%{transform:scale(1)}20%,40%{transform:scale(1.15)}0%,80%{opacity:1}to{opacity:.5}}"]})}var M=i(2340);function Ct(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",5),e.NdJ("cdkDragDropped",function(s){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onDragDrop(s))}),e.TgZ(1,"app-word",6),e._uU(2),e.qZA()()}if(2&n){const t=e.oxw().ngIf,r=e.oxw();e.Q6J("cdkDragData",t.currWord),e.xp6(2),e.hij(" ",r.formatWord(t.currWord,!0)," ")}}function Dt(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",7),e.NdJ("cdkDropListEntered",function(s){e.CHM(t);const a=e.oxw(2);return e.KtG(a.onDragEnter(s))})("cdkDropListExited",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.reset())}),e.TgZ(1,"app-word",8),e._uU(2),e.qZA()()}if(2&n){const t=o.$implicit,r=e.oxw().ngIf,s=e.oxw();e.Q6J("cdkDropListDisabled",t.done)("cdkDropListData",t),e.xp6(1),e.Q6J("state",s.wordState(t,r.hoveredWord,r.wrongWord)),e.xp6(1),e.hij(" ",s.formatWord(t.word,!1)," ")}}function xt(n,o){if(1&n&&(e.TgZ(0,"div",1)(1,"main",2),e.YNc(2,Ct,3,2,"div",3),e.qZA(),e.TgZ(3,"aside"),e.YNc(4,Dt,3,4,"div",4),e.qZA()()),2&n){const t=o.ngIf,r=e.oxw();e.xp6(2),e.Q6J("ngIf",t.currWord),e.xp6(2),e.Q6J("ngForOf",t.wordsStatus)("ngForTrackBy",r.trackByWord)}}let U=class I{constructor(o){this.game=o,this.wordsDone$=new f.X([]),this.wordsStatus$=(0,g.a)([this.game.wordset$,this.wordsDone$]).pipe((0,l.U)(([t,r])=>(t?.words||[]).map(s=>({word:s,done:r.includes(s)})))),this.wordsLeft$=this.wordsStatus$.pipe((0,l.U)(t=>t.filter(r=>!r.done).map(r=>r.word))),this.currWord$=this.wordsLeft$.pipe((0,l.U)(t=>t[Math.floor(Math.random()*t.length)])),this.hoveredWord$=new f.X(void 0),this.wrongWord$=new f.X(void 0),this.wrongMoves$=new f.X([]),this.stats$=(0,g.a)([this.wordsDone$,this.wordsLeft$,this.wrongMoves$]).pipe((0,l.U)(([t,r,s])=>{const a=t.length,C=s.length,D=a+C;return{done:a,left:r.length,wrong:C,total:D,scoreRatio:D>0?a/D:0}})),this.$$=(0,g.a)([this.wordsStatus$,this.currWord$,this.hoveredWord$,this.wrongWord$]).pipe((0,l.U)(([t,r,s,a])=>({wordsStatus:t,currWord:r,hoveredWord:s,wrongWord:a})))}ngOnInit(){const o=Date.now();this.game.patchSubGame({startedAt:o}),this.stats$.pipe((0,R.x)(z.Q),function mt(n,o){return t=>{const r=F(o);return"string"==typeof o?function ut(n,o,t){const r=n[o];B(n,t),n[o]=function(){r.apply(this,arguments),J(this,t),n[o]=r}}(n,o,r):B(n,r),t.pipe((0,ot.R)(n[r]))}}(this)).subscribe(t=>{const{scoreRatio:r,left:s}=t,a=s<=0?Date.now():void 0;this.game.patchSubGame({scoreRatio:r,endedAt:a})})}trackByWord(o,t){return t.word}formatWord(o,t){return o[t&&!this.inversed||this.inversed&&!t?"toLocaleUpperCase":"toLocaleLowerCase"]()}addWordDone(o){this.wordsDone$.next([...this.wordsDone$.value,o])}reset(){this.hoveredWord$.next(void 0),this.wrongWord$.next(void 0)}onDragDrop(o){var t=this;return(0,$.Z)(function*(){const r=o.item.data,s=o.container.data?.word;r===s?t.addWordDone(r):(t.reset(),t.wrongWord$.next(s),t.wrongMoves$.next([...t.wrongMoves$.value,{from:r,to:s}]),clearTimeout(t._aniTimer),t._aniTimer=setTimeout(()=>t.reset(),1200))})()}onDragEnter(o){this.reset(),this.hoveredWord$.next(o.container.data.word)}wordState(o,t,r){return o.done?m.Correct:t===o.word?m.Hover:r===o.word?m.Wrong:m.Idle}static#t=this.\u0275fac=function(t){return new(t||I)(e.Y36(u))};static#e=this.\u0275cmp=e.Xpm({type:I,selectors:[["app-map-lower-upper-words"]],inputs:{inversed:"inversed"},decls:2,vars:3,consts:[["cdkDropListGroup","","class","wrapper full-fill bg-op-5",4,"ngIf"],["cdkDropListGroup","",1,"wrapper","full-fill","bg-op-5"],["cdkDropList","",1,"flex-center"],["class","p-1","cdkDrag","",3,"cdkDragData","cdkDragDropped",4,"ngIf"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"p-1",3,"cdkDragData","cdkDragDropped"],["bgcolor","var(--color-primary-light-2)","innerClass","px-1 ts-120p"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited"],[3,"state"]],template:function(t,r){1&t&&(e.YNc(0,xt,5,3,"div",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,r.$$))},dependencies:[d.sg,d.O5,M.Wj,M.Fd,M.Zt,O,d.Ov],styles:[".wrapper[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto minmax(10em,30%)}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]{grid-template:8em auto/auto}}.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto;align-items:center;overflow:auto;gap:.5em;padding:1em}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{grid-template:auto/repeat(2,calc(50% - .25em))}}.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}"]})};function _t(n,o){1&n&&e._UZ(0,"app-map-lower-upper-words")}function $t(n,o){1&n&&e._UZ(0,"app-map-lower-upper-words",5),2&n&&e.Q6J("inversed",!0)}function Gt(n,o){if(1&n){const t=e.EpF();e.ynx(0)(1,1),e.YNc(2,_t,1,0,"app-map-lower-upper-words",2),e.YNc(3,$t,1,1,"app-map-lower-upper-words",3),e.BQk(),e.TgZ(4,"app-game-ended",4),e.NdJ("close",function(){const a=e.CHM(t).ngIf,c=e.oxw();return e.KtG(c.setNextOrExit(a.subGame.next))}),e.qZA(),e.BQk()}if(2&n){const t=o.ngIf,r=e.oxw();e.xp6(1),e.Q6J("ngSwitch",t.subGame.curr.type),e.xp6(1),e.Q6J("ngSwitchCase",r.SubGameType.MapLowerToUpper),e.xp6(1),e.Q6J("ngSwitchCase",r.SubGameType.MapUpperToLower),e.xp6(1),e.Q6J("currSubGame",t.subGame.curr)("nextSubGame",t.subGame.next)}}U=(0,Z.gn)([N()],U);let S=class L{constructor(o,t){this.game=o,this.router=t,this.SubGameType=y}setNextOrExit(o){o?this.game.setSubGameIndex(o.index):this.router.navigate(["/home"])}static#t=this.\u0275fac=function(t){return new(t||L)(e.Y36(u),e.Y36(x.F0))};static#e=this.\u0275cmp=e.Xpm({type:L,selectors:[["app-game"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"inversed",4,"ngSwitchCase"],[3,"currSubGame","nextSubGame","close"],[3,"inversed"]],template:function(t,r){1&t&&(e.YNc(0,Gt,5,5,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,r.game.gameInfo$))},dependencies:[d.O5,d.RF,d.n9,G,U,d.Ov],encapsulation:2})};S=(0,Z.gn)([N()],S);var Ot=i(6805),St=i(930);class h{constructor(o,t){this.game=o,this.router=t}canActivate(o){var t=this;return(0,$.Z)(function*(){const r=o.params.wordsetId,s=o.queryParams.subGames?.split(","),a=t.game.init(r,s);return t.router.createUrlTree(["/game",a.wordsetId])})()}static#t=this.\u0275fac=function(t){return new(t||h)(e.LFG(u),e.LFG(x.F0))};static#e=this.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac})}class v{constructor(o,t){this.game=o,this.router=t}canActivate(o){var t=this;return(0,$.Z)(function*(){const r=o.params.wordsetId,s=yield function Tt(n,o){const t="object"==typeof o;return new Promise((r,s)=>{const a=new St.Hp({next:c=>{r(c),a.unsubscribe()},error:s,complete:()=>{t?r(o.defaultValue):s(new Ot.K)}});n.subscribe(a)})}(t.game.game$),a=t.router.createUrlTree(["/game",r,"new"]);return!!s||a})()}static#t=this.\u0275fac=function(t){return new(t||v)(e.LFG(u),e.LFG(x.F0))};static#e=this.\u0275prov=e.Yz7({token:v,factory:v.\u0275fac})}const Mt=[{path:":wordsetId",component:S,canActivate:[v]},{path:":wordsetId/new",component:S,canActivate:[h]}];class T{static#t=this.\u0275fac=function(t){return new(t||T)};static#e=this.\u0275mod=e.oAB({type:T});static#o=this.\u0275inj=e.cJS({providers:[u,h,v],imports:[d.ez,x.Bz.forChild(Mt),P.q,_]})}}}]);