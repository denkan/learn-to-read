"use strict";(self.webpackChunkordspelet=self.webpackChunkordspelet||[]).push([[598],{1598:(sn,Ct,d)=>{d.r(Ct),d.d(Ct,{GameModule:()=>at});var x=d(6895),j=d(5072),bt=d(4463),Mt=d(793),e=d(4650);class Y{constructor(n){this.elemRef=n,this.resized=new e.vpe}onWindowResize(){this.resize()}ngOnInit(){this.resize(),setTimeout(()=>this.resize(),200)}resize(n=!0){const t=this.elemRef.nativeElement.width=this.elemRef.nativeElement.clientWidth,o=this.elemRef.nativeElement.height=this.elemRef.nativeElement.clientHeight;n&&this.resized.emit({width:t,height:o})}static#t=this.\u0275fac=function(t){return new(t||Y)(e.Y36(e.SBq))};static#e=this.\u0275dir=e.lG2({type:Y,selectors:[["canvas","auto-size",""]],hostBindings:function(t,o){1&t&&e.NdJ("resize",function(c){return o.onWindowResize(c)},!1,e.Jf7)},outputs:{resized:"resized"}})}class X{static#t=this.\u0275fac=function(t){return new(t||X)};static#e=this.\u0275mod=e.oAB({type:X});static#n=this.\u0275inj=e.cJS({})}const jt=["c"];class N{set audioData(n){n&&this.render(n)}render(n){const t=this.canvasRef?.nativeElement,o=t?.getContext("2d");if(!t||!o)return;const a=t.width,c=t.height,l=1*a/n.length;o.clearRect(0,0,a,c),o.lineWidth=2,o.strokeStyle="#888",o.beginPath();let v=0;for(var u=0;u<n.length;u++){var D=n[u]/128*c/2;0===u?o.moveTo(v,D):o.lineTo(v,D),v=u*l}o.lineTo(a,n[0]/128*c/2),o.stroke()}static#t=this.\u0275fac=function(t){return new(t||N)};static#e=this.\u0275cmp=e.Xpm({type:N,selectors:[["app-audio-visualizer"]],viewQuery:function(t,o){if(1&t&&e.Gf(jt,5),2&t){let a;e.iGM(a=e.CRH())&&(o.canvasRef=a.first)}},inputs:{audioData:"audioData"},decls:2,vars:0,consts:[["auto-size","",1,"full-fill"],["c",""]],template:function(t,o){1&t&&e._UZ(0,"canvas",0,1)},dependencies:[Y],styles:["[_nghost-%COMP%]{display:inline-block}"]})}class V{static#t=this.\u0275fac=function(t){return new(t||V)};static#e=this.\u0275mod=e.oAB({type:V});static#n=this.\u0275inj=e.cJS({imports:[X]})}var lt={};!function i(n,t,o,a){var c=!!(n.Worker&&n.Blob&&n.Promise&&n.OffscreenCanvas&&n.OffscreenCanvasRenderingContext2D&&n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype.transferControlToOffscreen&&n.URL&&n.URL.createObjectURL);function l(){}function v(s){var r=t.exports.Promise,f=void 0!==r?r:n.Promise;return"function"==typeof f?new f(s):(s(l,l),null)}var r,f,s,p,y,ft,u=(s=Math.floor(16.666666666666668),p={},y=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(r=function(g){var h=Math.random();return p[h]=requestAnimationFrame(function m(b){y===b||y+s-1<b?(y=b,delete p[h],g()):p[h]=requestAnimationFrame(m)}),h},f=function(g){p[g]&&cancelAnimationFrame(p[g])}):(r=function(g){return setTimeout(g,s)},f=function(g){return clearTimeout(g)}),{frame:r,cancel:f}),M=function(){var s,r,f={};return function(){if(s)return s;if(!o&&c){var y=["var CONFETTI, SIZE = {}, module = {};","("+i.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{s=new Worker(URL.createObjectURL(new Blob([y])))}catch(g){return void 0!==typeof console&&"function"==typeof console.warn&&console.warn("\u{1f38a} Could not load worker",g),null}!function p(y){function g(h,m){y.postMessage({options:h||{},callback:m})}y.init=function(m){var b=m.transferControlToOffscreen();y.postMessage({canvas:b},[b])},y.fire=function(m,b,T){if(r)return g(m,null),r;var _=Math.random().toString(36).slice(2);return r=v(function(k){function O(C){C.data.callback===_&&(delete f[_],y.removeEventListener("message",O),r=null,T(),k())}y.addEventListener("message",O),g(m,_),f[_]=O.bind(null,{data:{callback:_}})})},y.reset=function(){for(var m in y.postMessage({reset:!0}),f)f[m](),delete f[m]}}(s)}return s}}(),D={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function w(s,r,f){return function E(s,r){return r?r(s):s}(s&&function U(s){return null!=s}(s[r])?s[r]:D[r],f)}function S(s){return s<0?0:Math.floor(s)}function Be(s,r){return Math.floor(Math.random()*(r-s))+s}function mt(s){return parseInt(s,16)}function ze(s){return s.map(Ne)}function Ne(s){var r=String(s).replace(/[^0-9a-f]/gi,"");return r.length<6&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),{r:mt(r.substring(0,2)),g:mt(r.substring(2,4)),b:mt(r.substring(4,6))}}function Je(s){s.width=document.documentElement.clientWidth,s.height=document.documentElement.clientHeight}function He(s){var r=s.getBoundingClientRect();s.width=r.width,s.height=r.height}function Ye(s){var r=s.angle*(Math.PI/180),f=s.spread*(Math.PI/180);return{x:s.x,y:s.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*s.startVelocity+Math.random()*s.startVelocity,angle2D:-r+(.5*f-Math.random()*f),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:s.color,shape:s.shape,tick:0,totalTicks:s.ticks,decay:s.decay,drift:s.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*s.gravity,ovalScalar:.6,scalar:s.scalar}}function zt(s,r){var _,f=!s,p=!!w(r||{},"resize"),y=w(r,"disableForReducedMotion",Boolean),h=c&&w(r||{},"useWorker")?M():null,m=f?Je:He,b=!(!s||!h||!s.__confetti_initialized),T="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function k(C,gt,vt){for(var z=w(C,"particleCount",S),it=w(C,"angle",Number),ct=w(C,"spread",Number),F=w(C,"startVelocity",Number),Ke=w(C,"decay",Number),qe=w(C,"gravity",Number),tn=w(C,"drift",Number),Rt=w(C,"colors",ze),en=w(C,"ticks",Number),Jt=w(C,"shapes"),nn=w(C,"scalar"),Ht=function Re(s){var r=w(s,"origin",Object);return r.x=w(r,"x",Number),r.y=w(r,"y",Number),r}(C),Qt=z,wt=[],on=s.width*Ht.x,rn=s.height*Ht.y;Qt--;)wt.push(Ye({x:on,y:rn,angle:it,spread:ct,startVelocity:F,color:Rt[Qt%Rt.length],shape:Jt[Be(0,Jt.length)],ticks:en,decay:Ke,gravity:qe,drift:tn,scalar:nn}));return _?_.addFettis(wt):(_=function Ve(s,r,f,p,y){var m,b,g=r.slice(),h=s.getContext("2d"),T=v(function(_){function k(){m=b=null,h.clearRect(0,0,p.width,p.height),y(),_()}m=u.frame(function O(){o&&!(p.width===a.width&&p.height===a.height)&&(p.width=s.width=a.width,p.height=s.height=a.height),!p.width&&!p.height&&(f(s),p.width=s.width,p.height=s.height),h.clearRect(0,0,p.width,p.height),g=g.filter(function(C){return function Xe(s,r){r.x+=Math.cos(r.angle2D)*r.velocity+r.drift,r.y+=Math.sin(r.angle2D)*r.velocity+r.gravity,r.wobble+=r.wobbleSpeed,r.velocity*=r.decay,r.tiltAngle+=.1,r.tiltSin=Math.sin(r.tiltAngle),r.tiltCos=Math.cos(r.tiltAngle),r.random=Math.random()+2,r.wobbleX=r.x+10*r.scalar*Math.cos(r.wobble),r.wobbleY=r.y+10*r.scalar*Math.sin(r.wobble);var f=r.tick++/r.totalTicks,p=r.x+r.random*r.tiltCos,y=r.y+r.random*r.tiltSin,g=r.wobbleX+r.random*r.tiltCos,h=r.wobbleY+r.random*r.tiltSin;if(s.fillStyle="rgba("+r.color.r+", "+r.color.g+", "+r.color.b+", "+(1-f)+")",s.beginPath(),"circle"===r.shape)s.ellipse?s.ellipse(r.x,r.y,Math.abs(g-p)*r.ovalScalar,Math.abs(h-y)*r.ovalScalar,Math.PI/10*r.wobble,0,2*Math.PI):function je(s,r,f,p,y,g,h,m,b){s.save(),s.translate(r,f),s.rotate(g),s.scale(p,y),s.arc(0,0,1,h,m,b),s.restore()}(s,r.x,r.y,Math.abs(g-p)*r.ovalScalar,Math.abs(h-y)*r.ovalScalar,Math.PI/10*r.wobble,0,2*Math.PI);else if("star"===r.shape)for(var m=Math.PI/2*3,b=4*r.scalar,T=8*r.scalar,_=r.x,k=r.y,O=5,C=Math.PI/O;O--;)_=r.x+Math.cos(m)*T,k=r.y+Math.sin(m)*T,s.lineTo(_,k),m+=C,_=r.x+Math.cos(m)*b,k=r.y+Math.sin(m)*b,s.lineTo(_,k),m+=C;else s.moveTo(Math.floor(r.x),Math.floor(r.y)),s.lineTo(Math.floor(r.wobbleX),Math.floor(y)),s.lineTo(Math.floor(g),Math.floor(h)),s.lineTo(Math.floor(p),Math.floor(r.wobbleY));return s.closePath(),s.fill(),r.tick<r.totalTicks}(h,C)}),g.length?m=u.frame(O):k()}),b=k});return{addFettis:function(_){return g=g.concat(_),T},canvas:s,promise:T,reset:function(){m&&u.cancel(m),b&&b()}}}(s,wt,m,gt,vt)).promise}function O(C){var gt=y||w(C,"disableForReducedMotion",Boolean),vt=w(C,"zIndex",Number);if(gt&&T)return v(function(F){F()});f&&_?s=_.canvas:f&&!s&&(s=function Qe(s){var r=document.createElement("canvas");return r.style.position="fixed",r.style.top="0px",r.style.left="0px",r.style.pointerEvents="none",r.style.zIndex=s,r}(vt),document.body.appendChild(s)),p&&!b&&m(s);var z={width:s.width,height:s.height};function it(){if(h){var F={getBoundingClientRect:function(){if(!f)return s.getBoundingClientRect()}};return m(F),void h.postMessage({resize:{width:F.width,height:F.height}})}z.width=z.height=null}function ct(){_=null,p&&n.removeEventListener("resize",it),f&&s&&(document.body.removeChild(s),s=null,b=!1)}return h&&!b&&h.init(s),b=!0,h&&(s.__confetti_initialized=!0),p&&n.addEventListener("resize",it,!1),h?h.fire(C,z,ct):k(C,z,ct)}return O.reset=function(){h&&h.reset(),_&&_.reset()},O}function Nt(){return ft||(ft=zt(null,{useWorker:!0,resize:!0})),ft}t.exports=function(){return Nt().apply(this,arguments)},t.exports.reset=function(){Nt().reset()},t.exports.create=zt}(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),lt,!1);const Yt=lt.exports;class G{constructor(){this.fn=Yt,this.defaultOptions={particleCount:100,spread:70,origin:{y:.7}}}getOptions(n){return Object.assign({},this.defaultOptions,n??{})}run(n){const t=this.getOptions(n);return this.fn(t)}runDelay(n=0,t){return setTimeout(()=>this.run(t),n??0)}getOriginByCoord({x:n=0,y:t=0}){return{x:n/window.innerWidth,y:t/window.innerHeight}}static#t=this.\u0275fac=function(t){return new(t||G)};static#e=this.\u0275prov=e.Yz7({token:G,factory:G.\u0275fac,providedIn:"root"})}class R{constructor(n){this.confetti=n,this._options={...this.confetti.defaultOptions}}set options(n){this._options=this.confetti.getOptions(n)}get options(){return this._options}ngOnInit(){clearTimeout(this.timer),this.timer=this.confetti.runDelay(this.options.delay,this.options)}ngOnDestroy(){clearTimeout(this.timer)}static#t=this.\u0275fac=function(t){return new(t||R)(e.Y36(G))};static#e=this.\u0275dir=e.lG2({type:R,selectors:[["","confetti",""]],inputs:{options:["confetti","options"]},exportAs:["confetti"]})}class K{static#t=this.\u0275fac=function(t){return new(t||K)};static#e=this.\u0275mod=e.oAB({type:K});static#n=this.\u0275inj=e.cJS({})}var xt=d(7392);class J{constructor(){this.fill=!1,this.fillColor="var(--color-accent)"}static#t=this.\u0275fac=function(t){return new(t||J)};static#e=this.\u0275cmp=e.Xpm({type:J,selectors:[["app-star"]],inputs:{fill:"fill",fillColor:"fillColor"},decls:2,vars:2,template:function(t,o){1&t&&(e.TgZ(0,"mat-icon"),e._uU(1,"star"),e.qZA()),2&t&&e.Udp("color",o.fill?o.fillColor:"var(--color-fg-op-50)")},dependencies:[xt.Hw],styles:["[_nghost-%COMP%]{display:inline-block}"]})}function Xt(i,n){if(1&i&&(e.TgZ(0,"span",1),e._UZ(1,"app-star",2),e.qZA()),2&i){const t=n.$implicit,o=n.index,a=e.oxw();e.Udp("transform",a.warpedStyles[o]),e.xp6(1),e.Q6J("fill",null!=a.ratio&&a.ratio>=t)}}class H{constructor(){this.ratios=[0,.5,.9],this.warpedStyles=[]}ngOnChanges(){this.calcWarpedStyles()}calcWarpedStyles(){if(!this.warped)return;const n=this.warped,t=this.ratios.length/2,o=Math.ceil(t),a=new Array(o).fill(0).map((c,l)=>n*(l/(o-1)-n/2));a.push(a[a.length-1]),this.warpedStyles=this.ratios.map((c,l)=>`translateY(${-(l<=t?a[l]:a[2*t-l-1])}em)`)}static#t=this.\u0275fac=function(t){return new(t||H)};static#e=this.\u0275cmp=e.Xpm({type:H,selectors:[["app-stars"]],inputs:{ratio:"ratio",ratios:"ratios",warped:"warped"},features:[e.TTD],decls:1,vars:1,consts:[["class","star-wrapper",3,"transform",4,"ngFor","ngForOf"],[1,"star-wrapper"],[3,"fill"]],template:function(t,o){1&t&&e.YNc(0,Xt,2,3,"span",0),2&t&&e.Q6J("ngForOf",o.ratios)},dependencies:[x.sg,J],styles:[".star-wrapper[_ngcontent-%COMP%]{display:inline-block}"]})}class q{static#t=this.\u0275fac=function(t){return new(t||q)};static#e=this.\u0275mod=e.oAB({type:q});static#n=this.\u0275inj=e.cJS({imports:[x.ez,Mt.q]})}var Ot=d(655),kt=d(7579),Vt=d(727),te=(d(2076),d(515),d(5577),d(2722));const ee=e.GuJ,oe=Symbol("__destroy"),St=Symbol("__decoratorApplied");function Tt(i){return"string"==typeof i?Symbol(`__destroy__${i}`):oe}function Pt(i,n){i[n]||(i[n]=new kt.x)}function It(i,n){i[n]&&(i[n].next(),i[n].complete(),i[n]=null)}function Lt(i){i instanceof Vt.w0&&i.unsubscribe()}function Gt(i,n){return function(){if(i&&i.call(this),It(this,Tt()),n.arrayName&&function se(i){Array.isArray(i)&&i.forEach(Lt)}(this[n.arrayName]),n.checkProperties)for(const t in this)n.blackList?.includes(t)||Lt(this[t])}}function $t(i={}){return n=>{!function ne(i){return!!i[ee]}(n)?function ae(i,n){i.prototype.ngOnDestroy=Gt(i.prototype.ngOnDestroy,n)}(n,i):function ie(i,n){const t=i.\u0275pipe;t.onDestroy=Gt(t.onDestroy,n)}(n,i),function re(i){i.prototype[St]=!0}(n)}}function At(i,n){return t=>{const o=Tt(n);return"string"==typeof n?function de(i,n,t){const o=i[n];Pt(i,t),i[n]=function(){o.apply(this,arguments),It(this,t),i[n]=o}}(i,n,o):Pt(i,o),t.pipe((0,te.R)(i[o]))}}Symbol("CheckerHasBeenSet");var Q=(()=>{return(i=Q||(Q={}))[i.MapLowerToUpper=0]="MapLowerToUpper",i[i.MapUpperToLower=1]="MapUpperToLower",Q;var i})(),P=d(5861),A=d(1135),$=d(4004),dt=d(9841),ue=d(1884),tt=d(9300),pe=d(1881),he=d(2313);const Wt=window.SpeechRecognition||window.webkitSpeechRecognition;class W{constructor(){this.audioContext=new AudioContext,this.recognition=new Wt,this._status$=new A.X("detecting"),this.status$=this._status$.asObservable(),this._words$=new A.X([]),this.words$=this._words$.asObservable(),this._audioSignal$=new A.X({diff:0,data:Uint8Array.of(0)}),this.audioSignal$=this._audioSignal$.asObservable()}get status(){return this._status$.value}get words(){return this._words$.value}get audioSignal(){return this._audioSignal$.value}enableMicrophone(){var n=this;return(0,P.Z)(function*(){try{return n.audioStream=yield navigator.mediaDevices.getUserMedia({audio:!0}),yield new Promise(t=>setTimeout(t,100)),n.trackVoiceSignals(),!0}catch(t){return console.warn(t),n._status$.next("not-allowed"),!1}})()}start(n){var t=this;return(0,P.Z)(function*(){return yield t.enableMicrophone(),t.stop(),t._words$.next([]),t.recognition=new Wt,Object.assign(t.recognition,{continuous:!0,lang:"sv-SE",interimResults:!0,maxAlternatives:5},n||{}),t.recognition.addEventListener("result",a=>{const c=[];for(const l of a.results)for(const v of l)(v.transcript||"").trim().split(" ").forEach(M=>c.push(M));t._words$.next(c)}),t.recognition.addEventListener("error",a=>t._status$.next("not-allowed"===a.error?"not-allowed":"error")),t.recognition.addEventListener("start",()=>t._status$.next("started")),t.recognition.addEventListener("end",()=>t._status$.next("stopped")),t.recognition.start(),{words$:t.words$}})()}stop(){this.recognition&&"function"==typeof this.recognition.stop?this.recognition.stop():this._status$.next("stopped")}trackVoiceSignals(n=this.audioStream,t=this.audioContext){if(!n||!t)return;const o=t.createMediaStreamSource(n);var a=t.createAnalyser(),c=t.createGain();o.connect(c),c.connect(a),a.fftSize=4096;const l=()=>{requestAnimationFrame(l);const v=a.frequencyBinCount,u=new Uint8Array(v);a.smoothingTimeConstant=.5,c.gain.setValueAtTime(1,t.currentTime),a.getByteFrequencyData(u),a.getByteTimeDomainData(u);let M=1,D=0;for(var E=0;E<v;E++){var U=u[E]/128;M=Math.min(M,U),D=Math.max(M,U)}this._audioSignal$.next({diff:D-M,data:u})};l()}static#t=this.\u0275fac=function(t){return new(t||W)};static#e=this.\u0275prov=e.Yz7({token:W,factory:W.\u0275fac,providedIn:"root"})}class I{constructor(n,t){this.store=n,this.speech=t,this.game$=new A.X(null),this.wordsetId$=this.game$.pipe((0,$.U)(o=>o?.wordsetId)),this.wordset$=(0,dt.a)([this.store.wordSets$,this.wordsetId$]).pipe((0,$.U)(([o,a])=>o.find(c=>c.id===a))),this._subGameIndex$=new A.X(0),this.subGameIndex$=this._subGameIndex$.asObservable(),this.subGame$=(0,dt.a)([this.subGameIndex$,this.game$]).pipe((0,$.U)(([o,a])=>a?.subGames[o])),this.gameInfo$=(0,dt.a)([this.game$,this.wordset$,this.subGameIndex$]).pipe((0,ue.x)(pe.Q),(0,tt.h)(([o,a])=>!(!o||!a)),(0,$.U)(([o,a,c])=>{const l=(o?.subGames||[]).map((u,M)=>({index:M,...u}));return{...o,wordset:a,subGames:l,subGame:{curr:l[c],prev:l[c-1],next:l[c+1]}}}))}init(n,t){const o=Object.values(Q).filter(l=>"number"==typeof l);t||(t=o);const c={wordsetId:n,subGames:t.filter(l=>o.includes(parseInt(l.toString()))).map(l=>({type:l}))};return this.game$.next(c),this._subGameIndex$.next(0),c}setSubGameIndex(n){null==n&&(n=(this.game$.value?.subGames||[]).findIndex(t=>!!t.endedAt)),(n<0||n>=(this.game$.value?.subGames||[]).length)&&(n=0),this._subGameIndex$.next(n)}patchSubGame(n){var t=this;return(0,P.Z)(function*(){const o=t.game$.value;if(!o||!o.subGames)return;const c={...o.subGames[t._subGameIndex$.value],...n},l={...o,subGames:[...o.subGames]};return l.subGames[t._subGameIndex$.value]=c,t.game$.next(l),l})()}static#t=this.\u0275fac=function(t){return new(t||I)(e.LFG(he.d),e.LFG(W))};static#e=this.\u0275prov=e.Yz7({token:I,factory:I.\u0275fac})}var me=d(4859);function fe(i,n){1&i&&(e.TgZ(0,"span",10),e._uU(1,"COMMON.NEXT"),e.qZA())}function ge(i,n){1&i&&(e.TgZ(0,"span",10),e._uU(1,"COMMON.CLOSE"),e.qZA())}const ve=function(){return{delay:2e3}};function we(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2)(2,"header",3)(3,"h1",4),e._uU(4,"COMMON.NICEJOB"),e.qZA()(),e.TgZ(5,"div",5)(6,"div",6),e._UZ(7,"app-stars",7),e.qZA()(),e.TgZ(8,"footer",3)(9,"button",8),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.close.emit())}),e.YNc(10,fe,2,0,"span",9),e.YNc(11,ge,2,0,"span",9),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("confetti",e.DdM(5,ve)),e.xp6(6),e.Q6J("ratio",null==t.currSubGame?null:t.currSubGame.scoreRatio)("warped",.3),e.xp6(3),e.Q6J("ngIf",t.nextSubGame),e.xp6(1),e.Q6J("ngIf",!t.nextSubGame)}}class et{constructor(){this.close=new e.vpe}get show(){return!(!this.currSubGame?.endedAt||!this.currSubGame.scoreRatio)}static#t=this.\u0275fac=function(t){return new(t||et)};static#e=this.\u0275cmp=e.Xpm({type:et,selectors:[["app-game-ended"]],inputs:{currSubGame:"currSubGame",nextSubGame:"nextSubGame"},outputs:{close:"close"},decls:1,vars:1,consts:[["class","modal-wrapper fadeIn",4,"ngIf"],[1,"modal-wrapper","fadeIn"],[1,"modal-box","scaleUp",3,"confetti"],[1,"p-1","text-center"],["translate","",1,"m-0","scaleUp"],[1,"px-1","flex-center"],[1,"ts-300p","lh-80"],[1,"d-block",3,"ratio","warped"],["mat-raised-button","","color","primary",3,"click"],["translate","",4,"ngIf"],["translate",""]],template:function(t,o){1&t&&e.YNc(0,we,12,6,"div",0),2&t&&e.Q6J("ngIf",o.show)},dependencies:[x.O5,bt.Pi,me.lW,H,R],styles:[".fadeIn[_ngcontent-%COMP%]{opacity:0;animation:.5s _ngcontent-%COMP%_fadeIn forwards}.scaleUp[_ngcontent-%COMP%]{transform:scale(0);animation:.5s _ngcontent-%COMP%_scaleUp cubic-bezier(.5,0,.5,2.2) forwards}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_scaleUp{0%{transform:scale(0)}to{transform:scale(1)}}.modal-box[_ngcontent-%COMP%]{min-width:16em}.modal-box.scaleUp[_ngcontent-%COMP%]{animation-delay:.3s}.modal-box[_ngcontent-%COMP%]   h1.scaleUp[_ngcontent-%COMP%]{animation-delay:.8s}@keyframes _ngcontent-%COMP%_scaleUpSpin{0%{transform:scale(0) rotate(-180deg)}to{transform:scale(1) rotate(0)}}[_nghost-%COMP%]     app-stars .star-wrapper app-star{transform:scale(0) rotate(-180deg);animation:.7s _ngcontent-%COMP%_scaleUpSpin cubic-bezier(.5,0,.5,2.2) forwards}[_nghost-%COMP%]     app-stars .star-wrapper:nth-of-type(1) app-star{animation-delay:1s}[_nghost-%COMP%]     app-stars .star-wrapper:nth-of-type(2) app-star{animation-delay:1.2s}[_nghost-%COMP%]     app-stars .star-wrapper:nth-of-type(3) app-star{animation-delay:1.4s}"]})}const ye=["*"];var L=(()=>{return(i=L||(L={})).Idle="idle",i.Hover="hover",i.Wrong="wrong",i.Correct="correct",L;var i})();class nt{constructor(){this.state=L.Idle}static#t=this.\u0275fac=function(t){return new(t||nt)};static#e=this.\u0275cmp=e.Xpm({type:nt,selectors:[["app-word"]],inputs:{state:"state",bgcolor:"bgcolor",innerStyle:"innerStyle",innerClass:"innerClass"},ngContentSelectors:ye,decls:2,vars:7,consts:[[3,"ngClass","ngStyle"]],template:function(t,o){1&t&&(e.F$t(),e.TgZ(0,"span",0),e.Hsn(1),e.qZA()),2&t&&(e.Gre("state-",o.state,""),e.Udp("background-color",o.bgcolor),e.Q6J("ngClass",o.innerClass)("ngStyle",o.innerStyle))},dependencies:[x.mk,x.PC],styles:["[_nghost-%COMP%] > span[_ngcontent-%COMP%]{display:block;position:relative;padding:.5em;color:var(--color-fg);background:var(--color-bg);background:white;border-radius:.5em;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);transition:.2s;transition-property:transform,box-shadow,background}[_nghost-%COMP%] > span.state-idle[_ngcontent-%COMP%], [_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{background:lightyellow}[_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{transform:scale(1.15)}[_nghost-%COMP%] > span.state-wrong[_ngcontent-%COMP%]{background:salmon!important;animation:.5s .2s _ngcontent-%COMP%_wrong ease-in-out 1}[_nghost-%COMP%] > span.state-correct[_ngcontent-%COMP%]{background:palegreen!important;animation:1.5s .1s _ngcontent-%COMP%_correct ease-in-out 1 forwards}@keyframes _ngcontent-%COMP%_wrong{0%,to{transform:translate(0)}15%,45%,75%{transform:translate(-.5em)}30%,60%,90%{transform:translate(.5em)}}@keyframes _ngcontent-%COMP%_correct{0%,10%,30%,50%{transform:scale(1)}20%,40%{transform:scale(1.15)}0%,80%{opacity:1}to{opacity:.5}}"]})}class ot{constructor(){this.patch=new e.vpe}static#t=this.\u0275fac=function(t){return new(t||ot)};static#e=this.\u0275cmp=e.Xpm({type:ot,selectors:[["ng-component"]],inputs:{gameInfo:"gameInfo"},outputs:{patch:"patch"},decls:0,vars:0,template:function(t,o){},encapsulation:2})}var ut=d(9245),_e=d(4986),Zt=d(4482),pt=d(5403),Ce=d(8421);const Bt={leading:!0,trailing:!1};var Me=d(5963);var ke=d(590);const De=["iconRef"];function Se(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"div",2)(2,"span",3,4)(4,"mat-icon"),e._uU(5),e.qZA()(),e._UZ(6,"app-audio-visualizer",5),e.ALo(7,"async"),e.qZA(),e.BQk()),2&i){const t=n.ngIf,o=e.oxw(2);e.xp6(1),e.Udp("--shake-x",t.x)("--shake-y",t.y),e.xp6(4),e.Oqu(o.locked?"lock":"mood"),e.xp6(1),e.Q6J("audioData",e.lcZ(7,6,o.audioData$))}}function Te(i,n){if(1&i&&(e.ynx(0),e.YNc(1,Se,8,8,"ng-container",1),e.ALo(2,"async"),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.shakePos$))}}const Pe=["*"];let ht=class yt{constructor(n,t){this.speech=n,this.confetti=t,this.disabled=!1,this.lockedChanged=new e.vpe,this._locked$=new A.X(!0),this.locked$=this._locked$.asObservable(),this.shakePos$=this.speech.audioSignal$.pipe(function xe(i,n=_e.z,t=Bt){const o=(0,Me.H)(i,n);return function be(i,n=Bt){return(0,Zt.e)((t,o)=>{const{leading:a,trailing:c}=n;let l=!1,v=null,u=null,M=!1;const D=()=>{u?.unsubscribe(),u=null,c&&(w(),M&&o.complete())},E=()=>{u=null,M&&o.complete()},U=S=>u=(0,Ce.Xf)(i(S)).subscribe((0,pt.x)(o,D,E)),w=()=>{if(l){l=!1;const S=v;v=null,o.next(S),!M&&U(S)}};t.subscribe((0,pt.x)(o,S=>{l=!0,v=S,(!u||u.closed)&&(a?w():U(S))},()=>{M=!0,(!(c&&l&&u)||u.closed)&&o.complete()}))})}(()=>o,t)}(50),function Oe(){return(0,Zt.e)((i,n)=>{let t,o=!1;i.subscribe((0,pt.x)(n,a=>{const c=t;t=a,o&&n.next([c,a]),o=!0}))})}(),(0,$.U)(([o,a])=>{const c=u=>(Math.round(Math.random())?-1:1)*u;return{x:c(o.diff),y:c(a.diff)}})),this.audioData$=this.speech.audioSignal$.pipe((0,tt.h)(o=>!!o),(0,$.U)(o=>o.data)),this._initted=!1}get locked(){return this._locked$.value}get isListening(){return"started"===this.speech.status}ngOnChanges(n){n.disabled&&(this.disabled&&"started"===this.speech.status&&this.stop(),!this.disabled&&"started"!==this.speech.status&&this._initted&&this.start())}ngOnInit(){this.locked$.pipe(At(this)).subscribe(n=>this.lockedChanged.emit(n)),this.disabled||this.start(),this._initted=!0}ngOnDestroy(){this.stop()}start(){var n=this;return(0,P.Z)(function*(){n._locked$.next(!0);const{words$:t}=yield n.speech.start();t.pipe(At(n),(0,tt.h)(a=>!(!n.word||!a?.length)),(0,$.U)(a=>a.find(c=>c.toLocaleLowerCase().trim()===n.word.toLocaleLowerCase().trim())),(0,tt.h)(a=>!!a),(0,ke.P)()).subscribe(()=>n.breakLock())})()}stop(){this.speech.stop(),this._locked$.next(!1)}breakLock(){this._locked$.next(!1),this.speech.stop();const n=this.iconRef?.nativeElement.getBoundingClientRect();if(n){const a=this.confetti.getOriginByCoord({x:n.x+n.width/2,y:n.y+n.height/2});this.confetti.run({origin:a,particleCount:12,spread:70,startVelocity:15})}}static#t=this.\u0275fac=function(t){return new(t||yt)(e.Y36(W),e.Y36(G))};static#e=this.\u0275cmp=e.Xpm({type:yt,selectors:[["app-speech-lock"]],viewQuery:function(t,o){if(1&t&&e.Gf(De,5),2&t){let a;e.iGM(a=e.CRH())&&(o.iconRef=a.first)}},hostVars:4,hostBindings:function(t,o){2&t&&e.ekj("locked",o.locked)("listening",o.isListening)},inputs:{word:"word",disabled:"disabled"},outputs:{lockedChanged:"lockedChanged"},exportAs:["speechLock"],features:[e.TTD],ngContentSelectors:Pe,decls:3,vars:1,consts:[[1,"content"],[4,"ngIf"],[1,"box"],[1,"icon"],["iconRef",""],[3,"audioData"]],template:function(t,o){1&t&&(e.F$t(),e.TgZ(0,"div",0),e.Hsn(1),e.qZA(),e.YNc(2,Te,3,3,"ng-container",1)),2&t&&(e.xp6(2),e.Q6J("ngIf",!o.disabled))},dependencies:[x.O5,xt.Hw,N,x.Ov],styles:["[_nghost-%COMP%]{display:inline-block;position:relative;padding:1em 1em 1.5em}[_nghost-%COMP%]   .content[_ngcontent-%COMP%]{position:relative;z-index:2}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;z-index:1;background:white;border-radius:.5em;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);animation:.3s _ngcontent-%COMP%_pop ease-in forwards}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;background:white;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);width:2em;height:2em;position:absolute;z-index:4;left:50%;bottom:0;transform:translate(-50%,50%);background:var(--color-bg);border-radius:50%}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{font-size:125%}[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   app-audio-visualizer[_ngcontent-%COMP%]{display:none;width:calc(100% - 1em);height:2em;position:absolute;bottom:-2px;left:50%;transform:translate(-50%,50%);z-index:3}.locked[_nghost-%COMP%]   .box[_ngcontent-%COMP%]{animation:none}.listening[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{animation:1s _ngcontent-%COMP%_listening ease-in-out infinite;transition:.1s;transform:translate(calc(-50% + var(--shake-x) * .2em),calc(50% + var(--shake-y) * .2em))}.listening[_nghost-%COMP%]   .box[_ngcontent-%COMP%]   app-audio-visualizer[_ngcontent-%COMP%]{display:inline-block}@keyframes _ngcontent-%COMP%_pop{0%{transform:scale(1);opacity:1}to{transform:scale(1.5);opacity:0}}@keyframes _ngcontent-%COMP%_listening{0%,to{border-color:var(--color-fg)}50%{border-color:var(--color-warn)}}"]})};function Ie(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"app-speech-lock",5,6),e.NdJ("lockedChanged",function(a){e.CHM(t);const c=e.oxw();return e.KtG(c.isCurrWordLocked=a)}),e.TgZ(3,"app-word",7),e.NdJ("cdkDragDropped",function(a){e.CHM(t);const c=e.oxw();return e.KtG(c.onDragDrop(a))}),e._uU(4),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("word",t.currWord)("disabled",!t.useSpeechLock),e.xp6(2),e.Q6J("cdkDragData",t.currWord)("cdkDragBoundary",t.useSpeechLock&&t.isCurrWordLocked?"app-speech-lock":""),e.xp6(1),e.hij(" ",t.formatWord(t.currWord,!0)," ")}}function Le(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",8),e.NdJ("cdkDropListEntered",function(a){e.CHM(t);const c=e.oxw();return e.KtG(c.onDragEnter(a))})("cdkDropListExited",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.resetUI())}),e.TgZ(1,"app-word",9),e.NdJ("click",function(){const c=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.onWordChosen(c))}),e._uU(2),e.qZA()()}if(2&i){const t=n.$implicit,o=e.oxw();e.Q6J("cdkDropListDisabled",o.wordsDone.includes(t))("cdkDropListData",t),e.xp6(1),e.Q6J("state",o.wordState(t)),e.xp6(1),e.hij(" ",o.formatWord(t,!1)," ")}}ht=(0,Ot.gn)([$t()],ht);const Ge=function(){return[]};class rt extends ot{constructor(n){super(),this.confetti=n,this.useSpeechLock=!0,this.wordsDone=[],this.isCurrWordLocked=!0,this.wrongMoves=[]}ngOnInit(){const n=Date.now();this.patch.emit({startedAt:n}),this.randomWord()}getStats(){const n=this.gameInfo?.wordset.words||[],t=this.wordsDone,o=n.filter(M=>!this.wordsDone.includes(M)),a=this.wordsDone.length,l=this.wrongMoves.length,v=a+l;return{allWords:n,wordsLeft:o,wordsDone:t,done:a,left:o.length,wrong:l,total:v,scoreRatio:v>0?a/v:0}}sendStats(){const{scoreRatio:n,left:t}=this.getStats(),o=t<=0?Date.now():void 0;this.patch.emit({scoreRatio:n,endedAt:o})}randomWord(){var n=this;return(0,P.Z)(function*(){n.currWord=void 0,yield new Promise(a=>setTimeout(a,100));const{wordsLeft:t}=n.getStats(),o=Math.floor(Math.random()*t.length);n.currWord=t[o]})()}trackByValue(n,t){return t}formatWord(n,t){return n[t&&!this.inversed||this.inversed&&!t?"toLocaleUpperCase":"toLocaleLowerCase"]()}resetUI(){this.hoverWord=void 0,this.wrongWord=void 0}onWordChosen(n,t){const o=this.currWord,a=n;if(!o||this.isCurrWordLocked)return;const{wordsLeft:c}=this.getStats();o===a?(this.wordsDone.push(o),this.randomWord(),this.confettiByEvent(t)):(this.resetUI(),a&&c.includes(a)&&(this.wrongMoves.push({from:o,to:a}),this.wrongWord=a,clearTimeout(this._aniTimer),this._aniTimer=setTimeout(()=>this.resetUI(),1200))),this.sendStats()}onDragDrop(n){var t=this;return(0,P.Z)(function*(){t.onWordChosen(n.container.data,n.event)})()}onDragEnter(n){this.resetUI(),this.hoverWord=n.container.data}wordState(n){return this.wordsDone.includes(n)?L.Correct:this.hoverWord===n?L.Hover:this.wrongWord===n?L.Wrong:L.Idle}confettiByEvent(n){if(!n)return;const{clientX:t,clientY:o}=n.changedTouches?.[0]||n,a=this.confetti.getOriginByCoord({x:t,y:o});this.confetti.run({origin:a,particleCount:12,spread:70,startVelocity:15})}static#t=this.\u0275fac=function(t){return new(t||rt)(e.Y36(G))};static#e=this.\u0275cmp=e.Xpm({type:rt,selectors:[["app-map-lower-upper-words"]],inputs:{inversed:"inversed"},features:[e.qOj],decls:5,vars:6,consts:[["cdkDropListGroup","",1,"wrapper","full-fill","bg-op-5"],["cdkDropList","",1,"flex-center",3,"dblclick"],["class","p-1",4,"ngIf"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited",4,"ngFor","ngForOf","ngForTrackBy"],[1,"p-1"],[3,"word","disabled","lockedChanged"],["lockBox",""],["bgcolor","var(--color-primary-light-2)","innerClass","px-1 ts-120p","cdkDrag","",3,"cdkDragData","cdkDragBoundary","cdkDragDropped"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited"],[3,"state","click"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"main",1),e.NdJ("dblclick",function(){return o.useSpeechLock=!o.useSpeechLock}),e.YNc(2,Ie,5,5,"div",2),e.qZA(),e.TgZ(3,"aside"),e.YNc(4,Le,3,4,"div",3),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngIf",o.currWord),e.xp6(1),e.ekj("opacity-70",o.isCurrWordLocked),e.xp6(1),e.Q6J("ngForOf",(null==o.gameInfo||null==o.gameInfo.wordset?null:o.gameInfo.wordset.words)||e.DdM(5,Ge))("ngForTrackBy",o.trackByValue))},dependencies:[x.sg,x.O5,ut.Wj,ut.Fd,ut.Zt,nt,ht],styles:[".wrapper[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto minmax(10em,30%)}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]{grid-template:8em auto/auto}}.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto;align-items:center;overflow:auto;gap:.5em;padding:1em}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{grid-template:auto/repeat(2,calc(50% - .25em))}}.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]   .cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}"]})}function $e(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"app-map-lower-upper-words",5),e.NdJ("patch",function(a){e.CHM(t);const c=e.oxw(2);return e.KtG(c.game.patchSubGame(a))}),e.qZA()}if(2&i){const t=e.oxw().ngIf;e.Q6J("gameInfo",t)}}function Ee(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"app-map-lower-upper-words",6),e.NdJ("patch",function(a){e.CHM(t);const c=e.oxw(2);return e.KtG(c.game.patchSubGame(a))}),e.qZA()}if(2&i){const t=e.oxw().ngIf;e.Q6J("gameInfo",t)("inversed",!0)}}function Ue(i,n){if(1&i){const t=e.EpF();e.ynx(0)(1,1),e.YNc(2,$e,1,1,"app-map-lower-upper-words",2),e.YNc(3,Ee,1,2,"app-map-lower-upper-words",3),e.BQk(),e.TgZ(4,"app-game-ended",4),e.NdJ("close",function(){const c=e.CHM(t).ngIf,l=e.oxw();return e.KtG(l.setNextOrExit(c.subGame.next))}),e.qZA(),e.BQk()}if(2&i){const t=n.ngIf,o=e.oxw();e.xp6(1),e.Q6J("ngSwitch",t.subGame.curr.type),e.xp6(1),e.Q6J("ngSwitchCase",o.SubGameType.MapLowerToUpper),e.xp6(1),e.Q6J("ngSwitchCase",o.SubGameType.MapUpperToLower),e.xp6(1),e.Q6J("currSubGame",t.subGame.curr)("nextSubGame",t.subGame.next)}}let st=class _t{constructor(n,t){this.game=n,this.router=t,this.SubGameType=Q}setNextOrExit(n){n?this.game.setSubGameIndex(n.index):this.router.navigate(["/home"])}static#t=this.\u0275fac=function(t){return new(t||_t)(e.Y36(I),e.Y36(j.F0))};static#e=this.\u0275cmp=e.Xpm({type:_t,selectors:[["app-game"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngSwitch"],[3,"gameInfo","patch",4,"ngSwitchCase"],[3,"gameInfo","inversed","patch",4,"ngSwitchCase"],[3,"currSubGame","nextSubGame","close"],[3,"gameInfo","patch"],[3,"gameInfo","inversed","patch"]],template:function(t,o){1&t&&(e.YNc(0,Ue,5,5,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,o.game.gameInfo$))},dependencies:[x.O5,x.RF,x.n9,et,rt,x.Ov],encapsulation:2})};st=(0,Ot.gn)([$t()],st);var Fe=d(6805),Ae=d(930);class Z{constructor(n,t){this.game=n,this.router=t}canActivate(n){var t=this;return(0,P.Z)(function*(){const o=n.params.wordsetId,a=n.queryParams.subGames?.split(","),c=t.game.init(o,a);return t.router.createUrlTree(["/game",c.wordsetId])})()}static#t=this.\u0275fac=function(t){return new(t||Z)(e.LFG(I),e.LFG(j.F0))};static#e=this.\u0275prov=e.Yz7({token:Z,factory:Z.\u0275fac})}class B{constructor(n,t){this.game=n,this.router=t}canActivate(n){var t=this;return(0,P.Z)(function*(){const o=n.params.wordsetId,a=yield function We(i,n){const t="object"==typeof n;return new Promise((o,a)=>{const c=new Ae.Hp({next:l=>{o(l),c.unsubscribe()},error:a,complete:()=>{t?o(n.defaultValue):a(new Fe.K)}});i.subscribe(c)})}(t.game.game$),c=t.router.createUrlTree(["/game",o,"new"]);return!!a||c})()}static#t=this.\u0275fac=function(t){return new(t||B)(e.LFG(I),e.LFG(j.F0))};static#e=this.\u0275prov=e.Yz7({token:B,factory:B.\u0275fac})}const Ze=[{path:":wordsetId",component:st,canActivate:[B]},{path:":wordsetId/new",component:st,canActivate:[Z]}];class at{static#t=this.\u0275fac=function(t){return new(t||at)};static#e=this.\u0275mod=e.oAB({type:at});static#n=this.\u0275inj=e.cJS({providers:[I,Z,B],imports:[x.ez,j.Bz.forChild(Ze),bt.aw.forChild(),Mt.q,q,K,V]})}}}]);