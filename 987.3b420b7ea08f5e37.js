"use strict";(self.webpackChunkordspelet=self.webpackChunkordspelet||[]).push([[987],{1987:(Pt,me,f)=>{f.r(me),f.d(me,{GameModule:()=>V});var x=f(6895),J=f(6319),he=f(793),t=f(4650),ee={};!function a(n,e,s,i){var c=!!(n.Worker&&n.Blob&&n.Promise&&n.OffscreenCanvas&&n.OffscreenCanvasRenderingContext2D&&n.HTMLCanvasElement&&n.HTMLCanvasElement.prototype.transferControlToOffscreen&&n.URL&&n.URL.createObjectURL);function l(){}function _(o){var r=e.exports.Promise,h=void 0!==r?r:n.Promise;return"function"==typeof h?new h(o):(o(l,l),null)}var r,h,o,u,v,ie,$=(o=Math.floor(16.666666666666668),u={},v=0,"function"==typeof requestAnimationFrame&&"function"==typeof cancelAnimationFrame?(r=function(g){var p=Math.random();return u[p]=requestAnimationFrame(function m(b){v===b||v+o-1<b?(v=b,delete u[p],g()):u[p]=requestAnimationFrame(m)}),p},h=function(g){u[g]&&cancelAnimationFrame(u[g])}):(r=function(g){return setTimeout(g,o)},h=function(g){return clearTimeout(g)}),{frame:r,cancel:h}),j=function(){var o,r,h={};return function(){if(o)return o;if(!s&&c){var v=["var CONFETTI, SIZE = {}, module = {};","("+a.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join("\n");try{o=new Worker(URL.createObjectURL(new Blob([v])))}catch(g){return void 0!==typeof console&&"function"==typeof console.warn&&console.warn("\u{1f38a} Could not load worker",g),null}!function u(v){function g(p,m){v.postMessage({options:p||{},callback:m})}v.init=function(m){var b=m.transferControlToOffscreen();v.postMessage({canvas:b},[b])},v.fire=function(m,b,S){if(r)return g(m,null),r;var w=Math.random().toString(36).slice(2);return r=_(function(D){function M(y){y.data.callback===w&&(delete h[w],v.removeEventListener("message",M),r=null,S(),D())}v.addEventListener("message",M),g(m,w),h[w]=M.bind(null,{data:{callback:w}})})},v.reset=function(){for(var m in v.postMessage({reset:!0}),h)h[m](),delete h[m]}}(o)}return o}}(),se={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function C(o,r,h){return function gt(o,r){return r?r(o):o}(o&&function vt(o){return null!=o}(o[r])?o[r]:se[r],h)}function wt(o){return o<0?0:Math.floor(o)}function yt(o,r){return Math.floor(Math.random()*(r-o))+o}function ae(o){return parseInt(o,16)}function bt(o){return o.map(Ct)}function Ct(o){var r=String(o).replace(/[^0-9a-f]/gi,"");return r.length<6&&(r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),{r:ae(r.substring(0,2)),g:ae(r.substring(2,4)),b:ae(r.substring(4,6))}}function Mt(o){o.width=document.documentElement.clientWidth,o.height=document.documentElement.clientHeight}function Dt(o){var r=o.getBoundingClientRect();o.width=r.width,o.height=r.height}function Tt(o){var r=o.angle*(Math.PI/180),h=o.spread*(Math.PI/180);return{x:o.x,y:o.y,wobble:10*Math.random(),wobbleSpeed:Math.min(.11,.1*Math.random()+.05),velocity:.5*o.startVelocity+Math.random()*o.startVelocity,angle2D:-r+(.5*h-Math.random()*h),tiltAngle:(.5*Math.random()+.25)*Math.PI,color:o.color,shape:o.shape,tick:0,totalTicks:o.ticks,decay:o.decay,drift:o.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:3*o.gravity,ovalScalar:.6,scalar:o.scalar}}function Se(o,r){var w,h=!o,u=!!C(r||{},"resize"),v=C(r,"disableForReducedMotion",Boolean),p=c&&C(r||{},"useWorker")?j():null,m=h?Mt:Dt,b=!(!o||!p||!o.__confetti_initialized),S="function"==typeof matchMedia&&matchMedia("(prefers-reduced-motion)").matches;function D(y,ce,le){for(var A=C(y,"particleCount",wt),K=C(y,"angle",Number),q=C(y,"spread",Number),G=C(y,"startVelocity",Number),$t=C(y,"decay",Number),Gt=C(y,"gravity",Number),Lt=C(y,"drift",Number),$e=C(y,"colors",bt),kt=C(y,"ticks",Number),Ge=C(y,"shapes"),Et=C(y,"scalar"),Le=function xt(o){var r=C(o,"origin",Object);return r.x=C(r,"x",Number),r.y=C(r,"y",Number),r}(y),ke=A,de=[],Ft=o.width*Le.x,Ut=o.height*Le.y;ke--;)de.push(Tt({x:Ft,y:Ut,angle:K,spread:q,startVelocity:G,color:$e[ke%$e.length],shape:Ge[yt(0,Ge.length)],ticks:kt,decay:$t,gravity:Gt,drift:Lt,scalar:Et}));return w?w.addFettis(de):(w=function It(o,r,h,u,v){var m,b,g=r.slice(),p=o.getContext("2d"),S=_(function(w){function D(){m=b=null,p.clearRect(0,0,u.width,u.height),v(),w()}m=$.frame(function M(){s&&!(u.width===i.width&&u.height===i.height)&&(u.width=o.width=i.width,u.height=o.height=i.height),!u.width&&!u.height&&(h(o),u.width=o.width,u.height=o.height),p.clearRect(0,0,u.width,u.height),g=g.filter(function(y){return function St(o,r){r.x+=Math.cos(r.angle2D)*r.velocity+r.drift,r.y+=Math.sin(r.angle2D)*r.velocity+r.gravity,r.wobble+=r.wobbleSpeed,r.velocity*=r.decay,r.tiltAngle+=.1,r.tiltSin=Math.sin(r.tiltAngle),r.tiltCos=Math.cos(r.tiltAngle),r.random=Math.random()+2,r.wobbleX=r.x+10*r.scalar*Math.cos(r.wobble),r.wobbleY=r.y+10*r.scalar*Math.sin(r.wobble);var h=r.tick++/r.totalTicks,u=r.x+r.random*r.tiltCos,v=r.y+r.random*r.tiltSin,g=r.wobbleX+r.random*r.tiltCos,p=r.wobbleY+r.random*r.tiltSin;if(o.fillStyle="rgba("+r.color.r+", "+r.color.g+", "+r.color.b+", "+(1-h)+")",o.beginPath(),"circle"===r.shape)o.ellipse?o.ellipse(r.x,r.y,Math.abs(g-u)*r.ovalScalar,Math.abs(p-v)*r.ovalScalar,Math.PI/10*r.wobble,0,2*Math.PI):function Ot(o,r,h,u,v,g,p,m,b){o.save(),o.translate(r,h),o.rotate(g),o.scale(u,v),o.arc(0,0,1,p,m,b),o.restore()}(o,r.x,r.y,Math.abs(g-u)*r.ovalScalar,Math.abs(p-v)*r.ovalScalar,Math.PI/10*r.wobble,0,2*Math.PI);else if("star"===r.shape)for(var m=Math.PI/2*3,b=4*r.scalar,S=8*r.scalar,w=r.x,D=r.y,M=5,y=Math.PI/M;M--;)w=r.x+Math.cos(m)*S,D=r.y+Math.sin(m)*S,o.lineTo(w,D),m+=y,w=r.x+Math.cos(m)*b,D=r.y+Math.sin(m)*b,o.lineTo(w,D),m+=y;else o.moveTo(Math.floor(r.x),Math.floor(r.y)),o.lineTo(Math.floor(r.wobbleX),Math.floor(v)),o.lineTo(Math.floor(g),Math.floor(p)),o.lineTo(Math.floor(u),Math.floor(r.wobbleY));return o.closePath(),o.fill(),r.tick<r.totalTicks}(p,y)}),g.length?m=$.frame(M):D()}),b=D});return{addFettis:function(w){return g=g.concat(w),S},canvas:o,promise:S,reset:function(){m&&$.cancel(m),b&&b()}}}(o,de,m,ce,le)).promise}function M(y){var ce=v||C(y,"disableForReducedMotion",Boolean),le=C(y,"zIndex",Number);if(ce&&S)return _(function(G){G()});h&&w?o=w.canvas:h&&!o&&(o=function _t(o){var r=document.createElement("canvas");return r.style.position="fixed",r.style.top="0px",r.style.left="0px",r.style.pointerEvents="none",r.style.zIndex=o,r}(le),document.body.appendChild(o)),u&&!b&&m(o);var A={width:o.width,height:o.height};function K(){if(p){var G={getBoundingClientRect:function(){if(!h)return o.getBoundingClientRect()}};return m(G),void p.postMessage({resize:{width:G.width,height:G.height}})}A.width=A.height=null}function q(){w=null,u&&n.removeEventListener("resize",K),h&&o&&(document.body.removeChild(o),o=null,b=!1)}return p&&!b&&p.init(o),b=!0,p&&(o.__confetti_initialized=!0),u&&n.addEventListener("resize",K,!1),p?p.fire(y,A,q):D(y,A,q)}return M.reset=function(){p&&p.reset(),w&&w.reset()},M}function Ie(){return ie||(ie=Se(null,{useWorker:!0,resize:!0})),ie}e.exports=function(){return Ie().apply(this,arguments)},e.exports.reset=function(){Ie().reset()},e.exports.create=Se}(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),ee,!1);const Ee=ee.exports;class L{constructor(){this.fn=Ee,this.defaultOptions={particleCount:100,spread:70,origin:{y:.7}}}getOptions(n){return Object.assign({},this.defaultOptions,n??{})}run(n){const e=this.getOptions(n);return this.fn(e)}runDelay(n=0,e){return setTimeout(()=>this.run(e),n??0)}static#e=this.\u0275fac=function(e){return new(e||L)};static#t=this.\u0275prov=t.Yz7({token:L,factory:L.\u0275fac,providedIn:"root"})}class W{constructor(n){this.confetti=n,this._options={...this.confetti.defaultOptions}}set options(n){this._options=this.confetti.getOptions(n)}get options(){return this._options}ngOnInit(){clearTimeout(this.timer),this.timer=this.confetti.runDelay(this.options.delay,this.options)}ngOnDestroy(){clearTimeout(this.timer)}static#e=this.\u0275fac=function(e){return new(e||W)(t.Y36(L))};static#t=this.\u0275dir=t.lG2({type:W,selectors:[["","confetti",""]],inputs:{options:["confetti","options"]},exportAs:["confetti"]})}class R{static#e=this.\u0275fac=function(e){return new(e||R)};static#t=this.\u0275mod=t.oAB({type:R});static#n=this.\u0275inj=t.cJS({})}var Fe=f(3336);class Z{constructor(){this.fill=!1,this.fillColor="var(--color-accent)"}static#e=this.\u0275fac=function(e){return new(e||Z)};static#t=this.\u0275cmp=t.Xpm({type:Z,selectors:[["app-star"]],inputs:{fill:"fill",fillColor:"fillColor"},decls:2,vars:2,template:function(e,s){1&e&&(t.TgZ(0,"mat-icon"),t._uU(1,"star"),t.qZA()),2&e&&t.Udp("color",s.fill?s.fillColor:"var(--color-fg-op-50)")},dependencies:[Fe.Hw],styles:["[_nghost-%COMP%]{display:inline-block}"]})}function Ue(a,n){if(1&a&&(t.TgZ(0,"span",1),t._UZ(1,"app-star",2),t.qZA()),2&a){const e=n.$implicit,s=n.index,i=t.oxw();t.Udp("transform",i.warpedStyles[s]),t.xp6(1),t.Q6J("fill",null!=i.ratio&&i.ratio>=e)}}class B{constructor(){this.ratios=[0,.5,.9],this.warpedStyles=[]}ngOnChanges(){this.calcWarpedStyles()}calcWarpedStyles(){if(!this.warped)return;const n=this.warped,e=this.ratios.length/2,s=Math.ceil(e),i=new Array(s).fill(0).map((c,l)=>n*(l/(s-1)-n/2));i.push(i[i.length-1]),this.warpedStyles=this.ratios.map((c,l)=>`translateY(${-(l<=e?i[l]:i[2*e-l-1])}em)`)}static#e=this.\u0275fac=function(e){return new(e||B)};static#t=this.\u0275cmp=t.Xpm({type:B,selectors:[["app-stars"]],inputs:{ratio:"ratio",ratios:"ratios",warped:"warped"},features:[t.TTD],decls:1,vars:1,consts:[["class","star-wrapper",3,"transform",4,"ngFor","ngForOf"],[1,"star-wrapper"],[3,"fill"]],template:function(e,s){1&e&&t.YNc(0,Ue,2,3,"span",0),2&e&&t.Q6J("ngForOf",s.ratios)},dependencies:[x.sg,Z],styles:[".star-wrapper[_ngcontent-%COMP%]{display:inline-block}"]})}class Y{static#e=this.\u0275fac=function(e){return new(e||Y)};static#t=this.\u0275mod=t.oAB({type:Y});static#n=this.\u0275inj=t.cJS({imports:[x.ez,he.q]})}var fe=f(655),ge=f(7579),Pe=f(727),Ze=(f(2076),f(515),f(5577),f(2722));const Be=t.GuJ,je=Symbol("__destroy"),we=Symbol("__decoratorApplied");function ye(a){return"string"==typeof a?Symbol(`__destroy__${a}`):je}function be(a,n){a[n]||(a[n]=new ge.x)}function Ce(a,n){a[n]&&(a[n].next(),a[n].complete(),a[n]=null)}function xe(a){a instanceof Pe.w0&&a.unsubscribe()}function Me(a,n){return function(){if(a&&a.call(this),Ce(this,ye()),n.arrayName&&function Re(a){Array.isArray(a)&&a.forEach(xe)}(this[n.arrayName]),n.checkProperties)for(const e in this)n.blackList?.includes(e)||xe(this[e])}}function De(a={}){return n=>{!function Ne(a){return!!a[Be]}(n)?function Ye(a,n){a.prototype.ngOnDestroy=Me(a.prototype.ngOnDestroy,n)}(n,a):function Qe(a,n){const e=a.\u0275pipe;e.onDestroy=Me(e.onDestroy,n)}(n,a),function Je(a){a.prototype[we]=!0}(n)}}Symbol("CheckerHasBeenSet");var N=(()=>{return(a=N||(N={}))[a.MapLowerToUpper=0]="MapLowerToUpper",a[a.MapUpperToLower=1]="MapUpperToLower",N;var a})(),Q=f(5861),k=f(1135),O=f(4004),E=f(9841),te=f(1884),Ke=f(9300),ne=f(1881),qe=f(2313);class T{constructor(n){this.store=n,this.game$=new k.X(null),this.wordsetId$=this.game$.pipe((0,O.U)(e=>e?.wordsetId)),this.wordset$=(0,E.a)([this.store.wordSets$,this.wordsetId$]).pipe((0,O.U)(([e,s])=>e.find(i=>i.id===s))),this._subGameIndex$=new k.X(0),this.subGameIndex$=this._subGameIndex$.asObservable(),this.subGame$=(0,E.a)([this.subGameIndex$,this.game$]).pipe((0,O.U)(([e,s])=>s?.subGames[e])),this.gameInfo$=(0,E.a)([this.game$,this.wordset$,this.subGameIndex$]).pipe((0,te.x)(ne.Q),(0,Ke.h)(([e,s])=>!(!e||!s)),(0,O.U)(([e,s,i])=>{const c=(e?.subGames||[]).map((_,$)=>({index:$,..._}));return{...e,wordset:s,subGames:c,subGame:{curr:c[i],prev:c[i-1],next:c[i+1]}}}))}init(n,e){const s=Object.values(N).filter(l=>"number"==typeof l);e||(e=s);const c={wordsetId:n,subGames:e.filter(l=>s.includes(parseInt(l.toString()))).map(l=>({type:l}))};return this.game$.next(c),this._subGameIndex$.next(0),c}setSubGameIndex(n){null==n&&(n=(this.game$.value?.subGames||[]).findIndex(e=>!!e.endedAt)),(n<0||n>=(this.game$.value?.subGames||[]).length)&&(n=0),this._subGameIndex$.next(n)}patchSubGame(n){var e=this;return(0,Q.Z)(function*(){const s=e.game$.value;if(!s||!s.subGames)return;const c={...s.subGames[e._subGameIndex$.value],...n},l={...s,subGames:[...s.subGames]};return l.subGames[e._subGameIndex$.value]=c,e.game$.next(l),l})()}static#e=this.\u0275fac=function(e){return new(e||T)(t.LFG(qe.d))};static#t=this.\u0275prov=t.Yz7({token:T,factory:T.\u0275fac})}var d=f(7340),et=f(4859);function tt(a,n){1&a&&(t.TgZ(0,"span"),t._uU(1,"Next"),t.qZA())}function nt(a,n){1&a&&(t.TgZ(0,"span"),t._uU(1,"Close"),t.qZA())}const rt=function(){return{delay:2e3}};function ot(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"header",3)(3,"h1",4),t._uU(4,"Nice job!"),t.qZA()(),t.TgZ(5,"div",5)(6,"div",6),t._UZ(7,"app-stars",7),t.qZA()(),t.TgZ(8,"footer",3)(9,"button",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.close.emit())}),t.YNc(10,tt,2,0,"span",9),t.YNc(11,nt,2,0,"span",9),t.qZA()()()()}if(2&a){const e=t.oxw();t.Q6J("@showModalAnimation",void 0),t.xp6(1),t.Q6J("confetti",t.DdM(6,rt)),t.xp6(6),t.Q6J("ratio",null==e.currSubGame?null:e.currSubGame.scoreRatio)("warped",.3),t.xp6(3),t.Q6J("ngIf",!e.nextSubGame),t.xp6(1),t.Q6J("ngIf",e.nextSubGame)}}const F="0.5s cubic-bezier(.5,0,.5,2.2)";class X{constructor(){this.close=new t.vpe}get show(){return!(!this.currSubGame?.endedAt||!this.currSubGame.scoreRatio)}static#e=this.\u0275fac=function(e){return new(e||X)};static#t=this.\u0275cmp=t.Xpm({type:X,selectors:[["app-game-ended"]],inputs:{currSubGame:"currSubGame",nextSubGame:"nextSubGame"},outputs:{close:"close"},decls:1,vars:1,consts:[["class","modal-wrapper",4,"ngIf"],[1,"modal-wrapper"],[1,"modal-box",3,"confetti"],[1,"p-1","text-center"],[1,"m-0"],[1,"px-1","flex-center"],[1,"ts-300p","lh-80"],[1,"d-block",3,"ratio","warped"],["mat-raised-button","","color","primary",3,"click"],[4,"ngIf"]],template:function(e,s){1&e&&t.YNc(0,ot,12,7,"div",0),2&e&&t.Q6J("ngIf",s.show)},dependencies:[x.O5,et.lW,B,W],styles:[".modal-box[_ngcontent-%COMP%]{min-width:16em}"],data:{animation:[(0,d.X$)("showModalAnimation",[(0,d.eR)(":enter",[(0,d.ru)([(0,d.IO)(".modal-box",(0,d.oB)({transform:"scale(0)"})),(0,d.IO)(".modal-box h1",(0,d.oB)({transform:"scale(0)"})),(0,d.IO)("app-stars app-star",(0,d.oB)({transform:"scale(0) rotate(-180deg)"})),(0,d.IO)(":self",[(0,d.oB)({opacity:0}),(0,d.jt)(F,(0,d.oB)({opacity:1}))]),(0,d.IO)(".modal-box",(0,d.jt)(F,(0,d.oB)({transform:"scale(1)"})))]),(0,d.IO)(".modal-box h1",(0,d.jt)(F,(0,d.oB)({transform:"scale(1)"}))),(0,d.IO)("app-stars app-star",(0,d.EY)("0.3s",(0,d.jt)(F,(0,d.oB)({transform:"scale(1) rotate(0deg)"}))))]),(0,d.eR)(":leave",[(0,d.ru)([(0,d.IO)(".modal-box",(0,d.jt)(F,(0,d.oB)({transform:"scale(0)"}))),(0,d.IO)(":self",[(0,d.oB)({opacity:1}),(0,d.jt)(F,(0,d.oB)({opacity:0}))])])])])]}})}const st=["*"];var I=(()=>{return(a=I||(I={})).Idle="idle",a.Hover="hover",a.Wrong="wrong",a.Correct="correct",I;var a})();class z{constructor(){this.state=I.Idle}static#e=this.\u0275fac=function(e){return new(e||z)};static#t=this.\u0275cmp=t.Xpm({type:z,selectors:[["app-word"]],inputs:{state:"state",bgcolor:"bgcolor",innerStyle:"innerStyle",innerClass:"innerClass"},ngContentSelectors:st,decls:2,vars:7,consts:[[3,"ngClass","ngStyle"]],template:function(e,s){1&e&&(t.F$t(),t.TgZ(0,"span",0),t.Hsn(1),t.qZA()),2&e&&(t.Gre("state-",s.state,""),t.Udp("background-color",s.bgcolor),t.Q6J("ngClass",s.innerClass)("ngStyle",s.innerStyle))},dependencies:[x.mk,x.PC],styles:["[_nghost-%COMP%] > span[_ngcontent-%COMP%]{display:block;position:relative;padding:.5em;color:var(--color-fg);background:var(--color-bg);background:white;border-radius:.5em;box-shadow:.1em .1em .25em var(--color-dark-op-10);border:.1em solid var(--color-fg-op-50);transition:.2s;transition-property:transform,box-shadow,background}[_nghost-%COMP%] > span.state-idle[_ngcontent-%COMP%], [_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{background:lightyellow}[_nghost-%COMP%] > span.state-hover[_ngcontent-%COMP%]{transform:scale(1.15)}[_nghost-%COMP%] > span.state-wrong[_ngcontent-%COMP%]{background:salmon!important;animation:.5s .2s _ngcontent-%COMP%_wrong ease-in-out 1}[_nghost-%COMP%] > span.state-correct[_ngcontent-%COMP%]{background:palegreen!important;animation:1.5s .1s _ngcontent-%COMP%_correct ease-in-out 1 forwards}@keyframes _ngcontent-%COMP%_wrong{0%,to{transform:translate(0)}15%,45%,75%{transform:translate(-.5em)}30%,60%,90%{transform:translate(.5em)}}@keyframes _ngcontent-%COMP%_correct{0%,10%,30%,50%{transform:scale(1)}20%,40%{transform:scale(1.15)}0%,80%{opacity:1}to{opacity:.5}}"]})}var re=f(2340);function at(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",5),t.NdJ("cdkDragDropped",function(i){t.CHM(e);const c=t.oxw(2);return t.KtG(c.onDragDrop(i))}),t.TgZ(1,"app-word",6),t._uU(2),t.qZA()()}if(2&a){const e=t.oxw().ngIf,s=t.oxw();t.Q6J("cdkDragData",e.currWord),t.xp6(2),t.hij(" ",s.formatWord(e.currWord,!0)," ")}}function it(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",7),t.NdJ("cdkDropListEntered",function(i){t.CHM(e);const c=t.oxw(2);return t.KtG(c.onDragEnter(i))})("cdkDropListExited",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.reset())}),t.TgZ(1,"app-word",8),t._uU(2),t.qZA()()}if(2&a){const e=n.$implicit,s=t.oxw().ngIf,i=t.oxw();t.Q6J("cdkDropListDisabled",e.done)("cdkDropListData",e),t.xp6(1),t.Q6J("state",i.wordState(e,s.hoveredWord,s.wrongWord)),t.xp6(1),t.hij(" ",i.formatWord(e.word,!1)," ")}}function ct(a,n){if(1&a&&(t.TgZ(0,"div",1)(1,"main",2),t.YNc(2,at,3,2,"div",3),t.qZA(),t.TgZ(3,"aside"),t.YNc(4,it,3,4,"div",4),t.qZA()()),2&a){const e=n.ngIf,s=t.oxw();t.xp6(2),t.Q6J("ngIf",e.currWord),t.xp6(2),t.Q6J("ngForOf",e.wordsStatus)("ngForTrackBy",s.trackByWord)}}let oe=class ue{constructor(n,e){this.game=n,this.confetti=e,this.wordsDone$=new k.X([]),this.wordsStatus$=(0,E.a)([this.game.wordset$,this.wordsDone$]).pipe((0,O.U)(([s,i])=>(s?.words||[]).map(c=>({word:c,done:i.includes(c)})))),this.wordsLeft$=this.wordsStatus$.pipe((0,O.U)(s=>s.filter(i=>!i.done).map(i=>i.word))),this.currWord$=this.wordsLeft$.pipe((0,te.x)(ne.Q),(0,O.U)(s=>s[Math.floor(Math.random()*s.length)])),this.hoveredWord$=new k.X(void 0),this.wrongWord$=new k.X(void 0),this.wrongMoves$=new k.X([]),this.stats$=(0,E.a)([this.wordsDone$,this.wordsLeft$,this.wrongMoves$]).pipe((0,O.U)(([s,i,c])=>{const l=s.length,$=c.length,j=l+$;return{done:l,left:i.length,wrong:$,total:j,scoreRatio:j>0?l/j:0}})),this.$$=(0,E.a)([this.wordsStatus$,this.currWord$,this.hoveredWord$,this.wrongWord$]).pipe((0,O.U)(([s,i,c,l])=>({wordsStatus:s,currWord:i,hoveredWord:c,wrongWord:l})))}ngOnInit(){const n=Date.now();this.game.patchSubGame({startedAt:n}),this.stats$.pipe((0,te.x)(ne.Q),function Ve(a,n){return e=>{const s=ye(n);return"string"==typeof n?function He(a,n,e){const s=a[n];be(a,e),a[n]=function(){s.apply(this,arguments),Ce(this,e),a[n]=s}}(a,n,s):be(a,s),e.pipe((0,Ze.R)(a[s]))}}(this)).subscribe(e=>{const{scoreRatio:s,left:i}=e,c=i<=0?Date.now():void 0;this.game.patchSubGame({scoreRatio:s,endedAt:c})})}trackByWord(n,e){return e.word}formatWord(n,e){return n[e&&!this.inversed||this.inversed&&!e?"toLocaleUpperCase":"toLocaleLowerCase"]()}addWordDone(n){this.wordsDone$.next([...this.wordsDone$.value,n])}reset(){this.hoveredWord$.next(void 0),this.wrongWord$.next(void 0)}onDragDrop(n){var e=this;return(0,Q.Z)(function*(){const s=n.item.data,i=n.container.data?.word;s===i?(e.addWordDone(s),e.confettiByEvent(n.event)):(e.reset(),i&&!n.container.disabled&&(e.wrongWord$.next(i),e.wrongMoves$.next([...e.wrongMoves$.value,{from:s,to:i}]),clearTimeout(e._aniTimer),e._aniTimer=setTimeout(()=>e.reset(),1200)))})()}onDragEnter(n){this.reset(),this.hoveredWord$.next(n.container.data.word)}wordState(n,e,s){return n.done?I.Correct:e===n.word?I.Hover:s===n.word?I.Wrong:I.Idle}confettiByEvent(n){const{clientX:e,clientY:s}=n.changedTouches?.[0]||n,{innerWidth:i,innerHeight:c}=n.view;this.confetti.run({origin:{x:e/i,y:s/c},particleCount:12,spread:70,startVelocity:15})}static#e=this.\u0275fac=function(e){return new(e||ue)(t.Y36(T),t.Y36(L))};static#t=this.\u0275cmp=t.Xpm({type:ue,selectors:[["app-map-lower-upper-words"]],inputs:{inversed:"inversed"},decls:2,vars:3,consts:[["cdkDropListGroup","","class","wrapper full-fill bg-op-5",4,"ngIf"],["cdkDropListGroup","",1,"wrapper","full-fill","bg-op-5"],["cdkDropList","",1,"flex-center"],["class","p-1","cdkDrag","",3,"cdkDragData","cdkDragDropped",4,"ngIf"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited",4,"ngFor","ngForOf","ngForTrackBy"],["cdkDrag","",1,"p-1",3,"cdkDragData","cdkDragDropped"],["bgcolor","var(--color-primary-light-2)","innerClass","px-1 ts-120p"],["cdkDropList","",3,"cdkDropListDisabled","cdkDropListData","cdkDropListEntered","cdkDropListExited"],[3,"state"]],template:function(e,s){1&e&&(t.YNc(0,ct,5,3,"div",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,s.$$))},dependencies:[x.sg,x.O5,re.Wj,re.Fd,re.Zt,z,x.Ov],styles:[".wrapper[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto minmax(10em,30%)}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]{grid-template:8em auto/auto}}.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{display:grid;grid-template:auto/auto;align-items:center;overflow:auto;gap:.5em;padding:1em}@media (orientation: portrait){.wrapper[_ngcontent-%COMP%]   aside[_ngcontent-%COMP%]{grid-template:auto/repeat(2,calc(50% - .25em))}}.cdk-drag-placeholder[_ngcontent-%COMP%]{display:none}"]})};function lt(a,n){1&a&&t._UZ(0,"app-map-lower-upper-words")}function dt(a,n){1&a&&t._UZ(0,"app-map-lower-upper-words",5),2&a&&t.Q6J("inversed",!0)}function ut(a,n){if(1&a){const e=t.EpF();t.ynx(0)(1,1),t.YNc(2,lt,1,0,"app-map-lower-upper-words",2),t.YNc(3,dt,1,1,"app-map-lower-upper-words",3),t.BQk(),t.TgZ(4,"app-game-ended",4),t.NdJ("close",function(){const c=t.CHM(e).ngIf,l=t.oxw();return t.KtG(l.setNextOrExit(c.subGame.next))}),t.qZA(),t.BQk()}if(2&a){const e=n.ngIf,s=t.oxw();t.xp6(1),t.Q6J("ngSwitch",e.subGame.curr.type),t.xp6(1),t.Q6J("ngSwitchCase",s.SubGameType.MapLowerToUpper),t.xp6(1),t.Q6J("ngSwitchCase",s.SubGameType.MapUpperToLower),t.xp6(1),t.Q6J("currSubGame",e.subGame.curr)("nextSubGame",e.subGame.next)}}oe=(0,fe.gn)([De()],oe);let H=class pe{constructor(n,e){this.game=n,this.router=e,this.SubGameType=N}setNextOrExit(n){n?this.game.setSubGameIndex(n.index):this.router.navigate(["/home"])}static#e=this.\u0275fac=function(e){return new(e||pe)(t.Y36(T),t.Y36(J.F0))};static#t=this.\u0275cmp=t.Xpm({type:pe,selectors:[["app-game"]],decls:2,vars:3,consts:[[4,"ngIf"],[3,"ngSwitch"],[4,"ngSwitchCase"],[3,"inversed",4,"ngSwitchCase"],[3,"currSubGame","nextSubGame","close"],[3,"inversed"]],template:function(e,s){1&e&&(t.YNc(0,ut,5,5,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,s.game.gameInfo$))},dependencies:[x.O5,x.RF,x.n9,X,oe,x.Ov],encapsulation:2})};H=(0,fe.gn)([De()],H);var pt=f(6805),mt=f(930);class U{constructor(n,e){this.game=n,this.router=e}canActivate(n){var e=this;return(0,Q.Z)(function*(){const s=n.params.wordsetId,i=n.queryParams.subGames?.split(","),c=e.game.init(s,i);return e.router.createUrlTree(["/game",c.wordsetId])})()}static#e=this.\u0275fac=function(e){return new(e||U)(t.LFG(T),t.LFG(J.F0))};static#t=this.\u0275prov=t.Yz7({token:U,factory:U.\u0275fac})}class P{constructor(n,e){this.game=n,this.router=e}canActivate(n){var e=this;return(0,Q.Z)(function*(){const s=n.params.wordsetId,i=yield function ht(a,n){const e="object"==typeof n;return new Promise((s,i)=>{const c=new mt.Hp({next:l=>{s(l),c.unsubscribe()},error:i,complete:()=>{e?s(n.defaultValue):i(new pt.K)}});a.subscribe(c)})}(e.game.game$),c=e.router.createUrlTree(["/game",s,"new"]);return!!i||c})()}static#e=this.\u0275fac=function(e){return new(e||P)(t.LFG(T),t.LFG(J.F0))};static#t=this.\u0275prov=t.Yz7({token:P,factory:P.\u0275fac})}const ft=[{path:":wordsetId",component:H,canActivate:[P]},{path:":wordsetId/new",component:H,canActivate:[U]}];class V{static#e=this.\u0275fac=function(e){return new(e||V)};static#t=this.\u0275mod=t.oAB({type:V});static#n=this.\u0275inj=t.cJS({providers:[T,U,P],imports:[x.ez,J.Bz.forChild(ft),he.q,Y,R]})}}}]);